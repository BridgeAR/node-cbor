#!/usr/bin/env node

var cbor = require('../lib/cbor');
var utils = require('../lib/utils');
var package = require('../package.json');

var opts = require('commander')
.version(package.version)
.usage('[options] <file ...>')
.option('-x, --hex', 'Hex string output')
.parse(process.argv)

var argv = opts.args
if (argv.length === 0) {
  argv.push('-');
}

utils.streamFiles(argv, function(){
  var p = new utils.JSONparser();
  var d = new cbor.Encoder();
  p.pipe(d);
  var o = d
  if (opts.hex) {
    o = new utils.HexStream();
    d.pipe(o);
    o.on('end', function(){ process.stdout.write('\n') });
  }
  o.pipe(process.stdout);
  return p;
});
