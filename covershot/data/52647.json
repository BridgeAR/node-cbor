{"files":[{"filename":"BufferStream.js","coverage":91.9831223628692,"hits":218,"misses":19,"sloc":237,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  var BufferStream, EMPTY, assert, createEOF, stream, util,","coverage":1},"4":{"line":"    __hasProp = {}.hasOwnProperty,","coverage":""},"5":{"line":"    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },","coverage":11},"6":{"line":"    __slice = [].slice;","coverage":""},"7":{"line":"","coverage":""},"8":{"line":"  assert = require('assert');","coverage":1},"9":{"line":"","coverage":""},"10":{"line":"  util = require('util');","coverage":1},"11":{"line":"","coverage":""},"12":{"line":"  stream = require('stream');","coverage":1},"13":{"line":"","coverage":""},"14":{"line":"  EMPTY = new Buffer(0);","coverage":1},"15":{"line":"","coverage":""},"16":{"line":"  createEOF = function() {","coverage":1},"17":{"line":"    var e;","coverage":7},"18":{"line":"    e = new Error('EOF');","coverage":7},"19":{"line":"    e.BufferStreamEOF = true;","coverage":7},"20":{"line":"    return e;","coverage":7},"21":{"line":"  };","coverage":""},"22":{"line":"","coverage":""},"23":{"line":"  BufferStream = (function(_super) {","coverage":1},"24":{"line":"    __extends(BufferStream, _super);","coverage":1},"25":{"line":"","coverage":""},"26":{"line":"    function BufferStream(options) {","coverage":1},"27":{"line":"      var buf, startEnded, _ref, _ref1;","coverage":102},"28":{"line":"      if (options == null) {","coverage":102},"29":{"line":"        options = {};","coverage":95},"30":{"line":"      }","coverage":""},"31":{"line":"      this.clear();","coverage":102},"32":{"line":"      this._resetCB();","coverage":102},"33":{"line":"      BufferStream.__super__.constructor.call(this, options);","coverage":102},"34":{"line":"      this.growSize = (_ref = options.bsGrowSize) != null ? _ref : 512;","coverage":102},"35":{"line":"      this.on(\"finish\", (function(_this) {","coverage":102},"36":{"line":"        return function() {","coverage":102},"37":{"line":"          return _this._resetCB(createEOF());","coverage":6},"38":{"line":"        };","coverage":""},"39":{"line":"      })(this));","coverage":""},"40":{"line":"      buf = options.bsInit;","coverage":102},"41":{"line":"      if (Buffer.isBuffer(buf)) {","coverage":102},"42":{"line":"        this.append(buf);","coverage":3},"43":{"line":"        startEnded = (_ref1 = options.bsStartEnded) != null ? _ref1 : true;","coverage":3},"44":{"line":"        if (!!startEnded) {","coverage":3},"45":{"line":"          this.end();","coverage":3},"46":{"line":"        }","coverage":""},"47":{"line":"      } else if (!options.bsStartEmpty) {","coverage":99},"48":{"line":"        this.grow();","coverage":97},"49":{"line":"      }","coverage":""},"50":{"line":"    }","coverage":""},"51":{"line":"","coverage":""},"52":{"line":"    BufferStream.isBufferStream = function(obj) {","coverage":1},"53":{"line":"      return obj instanceof BufferStream;","coverage":3},"54":{"line":"    };","coverage":""},"55":{"line":"","coverage":""},"56":{"line":"    BufferStream.isEOFError = function(er) {","coverage":1},"57":{"line":"      return er &amp;&amp; (er instanceof Error) &amp;&amp; (er.BufferStreamEOF === true);","coverage":0},"58":{"line":"    };","coverage":""},"59":{"line":"","coverage":""},"60":{"line":"    BufferStream.prototype.encodeCBOR = function(enc) {","coverage":1},"61":{"line":"      return enc._packBuffer(this.flatten());","coverage":0},"62":{"line":"    };","coverage":""},"63":{"line":"","coverage":""},"64":{"line":"    BufferStream.prototype.isValid = function() {","coverage":1},"65":{"line":"      var len;","coverage":1},"66":{"line":"      len = this.bufs.reduce(function(prev, cur) {","coverage":1},"67":{"line":"        return prev + cur.length;","coverage":1},"68":{"line":"      }, 0);","coverage":""},"69":{"line":"      len -= this.left;","coverage":1},"70":{"line":"      return len === this.length;","coverage":1},"71":{"line":"    };","coverage":""},"72":{"line":"","coverage":""},"73":{"line":"    BufferStream.prototype._bufSizes = function() {","coverage":1},"74":{"line":"      return this.bufs.map(function(b) {","coverage":0},"75":{"line":"        return b.length;","coverage":0},"76":{"line":"      });","coverage":""},"77":{"line":"    };","coverage":""},"78":{"line":"","coverage":""},"79":{"line":"    BufferStream.prototype._write = function(chunk, encoding, cb) {","coverage":1},"80":{"line":"      if (!Buffer.isBuffer(chunk)) {","coverage":396},"81":{"line":"        return cb(new Error('String encoding not supported'));","coverage":1},"82":{"line":"      } else {","coverage":""},"83":{"line":"        this.append(chunk);","coverage":395},"84":{"line":"        return cb();","coverage":395},"85":{"line":"      }","coverage":""},"86":{"line":"    };","coverage":""},"87":{"line":"","coverage":""},"88":{"line":"    BufferStream.prototype._resetCB = function() {","coverage":1},"89":{"line":"      var args, cb, _ref;","coverage":113},"90":{"line":"      args = 1 &lt;= arguments.length ? __slice.call(arguments, 0) : [];","coverage":113},"91":{"line":"      _ref = [this.waitingCB, null, Number.MAX_VALUE], cb = _ref[0], this.waitingCB = _ref[1], this.waitingLen = _ref[2];","coverage":113},"92":{"line":"      if (cb &amp;&amp; args.length) {","coverage":113},"93":{"line":"        cb.apply(this, args);","coverage":6},"94":{"line":"      }","coverage":""},"95":{"line":"      return cb;","coverage":113},"96":{"line":"    };","coverage":""},"97":{"line":"","coverage":""},"98":{"line":"    BufferStream.prototype._notifyWaiter = function() {","coverage":1},"99":{"line":"      var buf;","coverage":4},"100":{"line":"      assert.ok(this.waitingCB);","coverage":4},"101":{"line":"      buf = this.read(this.waitingLen);","coverage":4},"102":{"line":"      return this._resetCB(null, buf);","coverage":4},"103":{"line":"    };","coverage":""},"104":{"line":"","coverage":""},"105":{"line":"    BufferStream.prototype.read = function(length) {","coverage":1},"106":{"line":"      var b, buf, got, last, lastbuf, left, lenW, lenZ, local_left, some;","coverage":88},"107":{"line":"      buf = null;","coverage":88},"108":{"line":"      lenZ = this.bufs[0].length;","coverage":88},"109":{"line":"      if (length == null) {","coverage":88},"110":{"line":"        length = 0;","coverage":84},"111":{"line":"      }","coverage":""},"112":{"line":"      lenW = (function() {","coverage":88},"113":{"line":"        switch (length) {","coverage":88},"114":{"line":"          case 0:","coverage":""},"115":{"line":"            return this.length;","coverage":84},"116":{"line":"          case -1:","coverage":""},"117":{"line":"            return Math.min(this.length, lenZ);","coverage":0},"118":{"line":"          default:","coverage":""},"119":{"line":"            return Math.min(this.length, length);","coverage":4},"120":{"line":"        }","coverage":""},"121":{"line":"      }).call(this);","coverage":""},"122":{"line":"      if (lenZ === lenW) {","coverage":88},"123":{"line":"        buf = this.bufs.shift();","coverage":1},"124":{"line":"      } else if (lenZ &gt; lenW) {","coverage":87},"125":{"line":"        buf = this.bufs[0].slice(0, lenW);","coverage":86},"126":{"line":"        this.bufs[0] = this.bufs[0].slice(lenW);","coverage":86},"127":{"line":"      } else if (lenW === this.length) {","coverage":1},"128":{"line":"        local_left = null;","coverage":0},"129":{"line":"        if (this.left !== 0) {","coverage":0},"130":{"line":"          lastbuf = this.bufs[this.bufs.length - 1];","coverage":0},"131":{"line":"          if (this.left === lastbuf.length) {","coverage":0},"132":{"line":"            local_left = this.bufs.pop();","coverage":0},"133":{"line":"          } else {","coverage":""},"134":{"line":"            local_left = lastbuf.slice(lastbuf.length - this.left);","coverage":0},"135":{"line":"          }","coverage":""},"136":{"line":"        }","coverage":""},"137":{"line":"        buf = Buffer.concat(this.bufs, this.length);","coverage":0},"138":{"line":"        this.bufs = local_left ? [local_left] : [];","coverage":0},"139":{"line":"      } else {","coverage":""},"140":{"line":"        some = [];","coverage":1},"141":{"line":"        got = 0;","coverage":1},"142":{"line":"        while (got &lt; lenW) {","coverage":1},"143":{"line":"          b = this.bufs.shift();","coverage":2},"144":{"line":"          some.push(b);","coverage":2},"145":{"line":"          got += b.length;","coverage":2},"146":{"line":"        }","coverage":""},"147":{"line":"        buf = Buffer.concat(some, lenW);","coverage":1},"148":{"line":"        if (got &gt; lenW) {","coverage":1},"149":{"line":"          last = some[some.length - 1];","coverage":1},"150":{"line":"          left = got - lenW;","coverage":1},"151":{"line":"          this.bufs.unshift(last.slice(last.length - left));","coverage":1},"152":{"line":"        }","coverage":""},"153":{"line":"      }","coverage":""},"154":{"line":"      this.length -= lenW;","coverage":88},"155":{"line":"      return buf;","coverage":88},"156":{"line":"    };","coverage":""},"157":{"line":"","coverage":""},"158":{"line":"    BufferStream.prototype.isEOF = function() {","coverage":1},"159":{"line":"      return (this.length === 0) &amp;&amp; this._writableState.finished;","coverage":0},"160":{"line":"    };","coverage":""},"161":{"line":"","coverage":""},"162":{"line":"    BufferStream.prototype.wait = function(length, cb) {","coverage":1},"163":{"line":"      if (this.waitingCB) {","coverage":11},"164":{"line":"        throw new Error('Invalid state.  Cannot wait while already waiting.');","coverage":1},"165":{"line":"      }","coverage":""},"166":{"line":"      if (!((typeof length === 'number') &amp;&amp; (length &gt;= 0))) {","coverage":10},"167":{"line":"        throw new Error(\"length required, must be non-negative number: \" + length);","coverage":1},"168":{"line":"      }","coverage":""},"169":{"line":"      if (typeof cb !== 'function') {","coverage":9},"170":{"line":"        throw new Error('cb required, must be function');","coverage":1},"171":{"line":"      }","coverage":""},"172":{"line":"      if (length === 0) {","coverage":8},"173":{"line":"        return process.nextTick((function(_this) {","coverage":1},"174":{"line":"          return function() {","coverage":1},"175":{"line":"            return cb.call(_this, null, EMPTY);","coverage":1},"176":{"line":"          };","coverage":""},"177":{"line":"        })(this));","coverage":""},"178":{"line":"      } else {","coverage":""},"179":{"line":"        this.waitingCB = cb;","coverage":7},"180":{"line":"        this.waitingLen = length;","coverage":7},"181":{"line":"        if (this.length &gt;= length) {","coverage":7},"182":{"line":"          return this._notifyWaiter();","coverage":1},"183":{"line":"        } else if (this._writableState.ended) {","coverage":6},"184":{"line":"          return this._resetCB(createEOF());","coverage":1},"185":{"line":"        }","coverage":""},"186":{"line":"      }","coverage":""},"187":{"line":"    };","coverage":""},"188":{"line":"","coverage":""},"189":{"line":"    BufferStream.prototype.clear = function() {","coverage":1},"190":{"line":"      this.bufs = [];","coverage":105},"191":{"line":"      this.length = 0;","coverage":105},"192":{"line":"      return this.left = 0;","coverage":105},"193":{"line":"    };","coverage":""},"194":{"line":"","coverage":""},"195":{"line":"    BufferStream.prototype._trimLast = function() {","coverage":1},"196":{"line":"      var last, old;","coverage":104},"197":{"line":"      old = this.left;","coverage":104},"198":{"line":"      if (this.left &gt; 0) {","coverage":104},"199":{"line":"        last = this.bufs.pop();","coverage":3},"200":{"line":"        if (this.left !== last.length) {","coverage":3},"201":{"line":"          this.bufs.push(last.slice(0, last.length - this.left));","coverage":1},"202":{"line":"        }","coverage":""},"203":{"line":"        this.left = 0;","coverage":3},"204":{"line":"      }","coverage":""},"205":{"line":"      return old;","coverage":104},"206":{"line":"    };","coverage":""},"207":{"line":"","coverage":""},"208":{"line":"    BufferStream.prototype._lengthen = function(size) {","coverage":1},"209":{"line":"      var len;","coverage":425},"210":{"line":"      assert.ok(size &gt; 0);","coverage":425},"211":{"line":"      this.length += size;","coverage":425},"212":{"line":"      len = this.length;","coverage":425},"213":{"line":"      if (this.length &gt;= this.waitingLen) {","coverage":425},"214":{"line":"        this._notifyWaiter();","coverage":3},"215":{"line":"      }","coverage":""},"216":{"line":"      return len;","coverage":425},"217":{"line":"    };","coverage":""},"218":{"line":"","coverage":""},"219":{"line":"    BufferStream.prototype.grow = function(size) {","coverage":1},"220":{"line":"      var b, s;","coverage":101},"221":{"line":"      this._trimLast();","coverage":101},"222":{"line":"      s = size != null ? size : this.growSize;","coverage":101},"223":{"line":"      b = new Buffer(s);","coverage":101},"224":{"line":"      this.bufs.push(b);","coverage":101},"225":{"line":"      this.left = s;","coverage":101},"226":{"line":"      return b;","coverage":101},"227":{"line":"    };","coverage":""},"228":{"line":"","coverage":""},"229":{"line":"    BufferStream.prototype.append = function(buf) {","coverage":1},"230":{"line":"      var lastbuf, len;","coverage":408},"231":{"line":"      assert.ok(Buffer.isBuffer(buf));","coverage":408},"232":{"line":"      len = buf.length;","coverage":408},"233":{"line":"      if (len === 0) {","coverage":408},"234":{"line":"        return;","coverage":1},"235":{"line":"      }","coverage":""},"236":{"line":"      if (this.left === 0) {","coverage":407},"237":{"line":"        this.bufs.push(buf);","coverage":7},"238":{"line":"      } else if (len &gt; this.left) {","coverage":400},"239":{"line":"        this._trimLast();","coverage":3},"240":{"line":"        this.bufs.push(buf);","coverage":3},"241":{"line":"      } else {","coverage":""},"242":{"line":"        lastbuf = this.bufs[this.bufs.length - 1];","coverage":397},"243":{"line":"        buf.copy(lastbuf, lastbuf.length - this.left);","coverage":397},"244":{"line":"        this.left -= len;","coverage":397},"245":{"line":"      }","coverage":""},"246":{"line":"      return this._lengthen(len);","coverage":407},"247":{"line":"    };","coverage":""},"248":{"line":"","coverage":""},"249":{"line":"    BufferStream.prototype.flatten = function() {","coverage":1},"250":{"line":"      var b;","coverage":13},"251":{"line":"      if (this.length === 0) {","coverage":13},"252":{"line":"        this.left = 0;","coverage":2},"253":{"line":"        this.bufs = [];","coverage":2},"254":{"line":"        return EMPTY;","coverage":2},"255":{"line":"      }","coverage":""},"256":{"line":"      b = null;","coverage":11},"257":{"line":"      switch (this.bufs.length) {","coverage":11},"258":{"line":"        case 0:","coverage":""},"259":{"line":"          assert.fail(this.length, \"Invalid state.  No buffers when length&gt;0.\");","coverage":0},"260":{"line":"          break;","coverage":0},"261":{"line":"        case 1:","coverage":""},"262":{"line":"          if (this.left === 0) {","coverage":9},"263":{"line":"            b = this.bufs[0];","coverage":6},"264":{"line":"          } else {","coverage":""},"265":{"line":"            b = this.bufs[0].slice(0, this.length);","coverage":3},"266":{"line":"            this.bufs = [b];","coverage":3},"267":{"line":"            this.left = 0;","coverage":3},"268":{"line":"          }","coverage":""},"269":{"line":"          break;","coverage":9},"270":{"line":"        default:","coverage":""},"271":{"line":"          if (this.left === this.bufs[this.bufs.length - 1].length) {","coverage":2},"272":{"line":"            this.bufs.pop();","coverage":1},"273":{"line":"          }","coverage":""},"274":{"line":"          b = Buffer.concat(this.bufs, this.length);","coverage":2},"275":{"line":"          this.bufs = [b];","coverage":2},"276":{"line":"          this.left = 0;","coverage":2},"277":{"line":"      }","coverage":""},"278":{"line":"      return b;","coverage":11},"279":{"line":"    };","coverage":""},"280":{"line":"","coverage":""},"281":{"line":"    BufferStream.prototype.slice = function(start, end) {","coverage":1},"282":{"line":"      return this.flatten().slice(start, end);","coverage":1},"283":{"line":"    };","coverage":""},"284":{"line":"","coverage":""},"285":{"line":"    BufferStream.prototype.fill = function(val, offset, end) {","coverage":1},"286":{"line":"      return this.flatten().fill(val, offset, end);","coverage":1},"287":{"line":"    };","coverage":""},"288":{"line":"","coverage":""},"289":{"line":"    BufferStream.prototype.toJSON = function() {","coverage":1},"290":{"line":"      return this.flatten().toJSON();","coverage":1},"291":{"line":"    };","coverage":""},"292":{"line":"","coverage":""},"293":{"line":"    BufferStream.prototype.toString = function(encoding) {","coverage":1},"294":{"line":"      if (encoding == null) {","coverage":0},"295":{"line":"        encoding = 'hex';","coverage":0},"296":{"line":"      }","coverage":""},"297":{"line":"      return this.flatten().toString(encoding);","coverage":0},"298":{"line":"    };","coverage":""},"299":{"line":"","coverage":""},"300":{"line":"    BufferStream.prototype.ensure = function(len) {","coverage":1},"301":{"line":"      if (this.left &lt; len) {","coverage":18},"302":{"line":"        return this.grow(Math.max(this.growSize, len));","coverage":1},"303":{"line":"      } else {","coverage":""},"304":{"line":"        return this.bufs[this.bufs.length - 1];","coverage":17},"305":{"line":"      }","coverage":""},"306":{"line":"    };","coverage":""},"307":{"line":"","coverage":""},"308":{"line":"    BufferStream.prototype.writeString = function(value, length, encoding) {","coverage":1},"309":{"line":"      var b;","coverage":5},"310":{"line":"      if (encoding == null) {","coverage":5},"311":{"line":"        encoding = 'utf8';","coverage":5},"312":{"line":"      }","coverage":""},"313":{"line":"      if (length == null) {","coverage":5},"314":{"line":"        length = Buffer.byteLength(value, encoding);","coverage":5},"315":{"line":"      }","coverage":""},"316":{"line":"      if (length === 0) {","coverage":5},"317":{"line":"        return;","coverage":1},"318":{"line":"      }","coverage":""},"319":{"line":"      b = this.ensure(length);","coverage":4},"320":{"line":"      b.write(value, b.length - this.left, length, encoding);","coverage":4},"321":{"line":"      this.left -= length;","coverage":4},"322":{"line":"      return this._lengthen(length);","coverage":4},"323":{"line":"    };","coverage":""},"324":{"line":"","coverage":""},"325":{"line":"    BufferStream._write_gen = function(meth, len) {","coverage":1},"326":{"line":"      return function(val) {","coverage":14},"327":{"line":"        var b;","coverage":14},"328":{"line":"        b = this.ensure(len);","coverage":14},"329":{"line":"        b[meth].call(b, val, b.length - this.left, true);","coverage":14},"330":{"line":"        this.left -= len;","coverage":14},"331":{"line":"        return this._lengthen(len);","coverage":14},"332":{"line":"      };","coverage":""},"333":{"line":"    };","coverage":""},"334":{"line":"","coverage":""},"335":{"line":"    BufferStream.prototype.writeUInt8 = BufferStream._write_gen('writeUInt8', 1);","coverage":1},"336":{"line":"","coverage":""},"337":{"line":"    BufferStream.prototype.writeUInt16LE = BufferStream._write_gen('writeUInt16LE', 2);","coverage":1},"338":{"line":"","coverage":""},"339":{"line":"    BufferStream.prototype.writeUInt16BE = BufferStream._write_gen('writeUInt16BE', 2);","coverage":1},"340":{"line":"","coverage":""},"341":{"line":"    BufferStream.prototype.writeUInt32LE = BufferStream._write_gen('writeUInt32LE', 4);","coverage":1},"342":{"line":"","coverage":""},"343":{"line":"    BufferStream.prototype.writeUInt32BE = BufferStream._write_gen('writeUInt32BE', 4);","coverage":1},"344":{"line":"","coverage":""},"345":{"line":"    BufferStream.prototype.writeInt8 = BufferStream._write_gen('writeInt8', 1);","coverage":1},"346":{"line":"","coverage":""},"347":{"line":"    BufferStream.prototype.writeInt16LE = BufferStream._write_gen('writeInt16LE', 2);","coverage":1},"348":{"line":"","coverage":""},"349":{"line":"    BufferStream.prototype.writeInt16BE = BufferStream._write_gen('writeInt16BE', 2);","coverage":1},"350":{"line":"","coverage":""},"351":{"line":"    BufferStream.prototype.writeInt32LE = BufferStream._write_gen('writeInt32LE', 4);","coverage":1},"352":{"line":"","coverage":""},"353":{"line":"    BufferStream.prototype.writeInt32BE = BufferStream._write_gen('writeInt32BE', 4);","coverage":1},"354":{"line":"","coverage":""},"355":{"line":"    BufferStream.prototype.writeFloatLE = BufferStream._write_gen('writeFloatLE', 4);","coverage":1},"356":{"line":"","coverage":""},"357":{"line":"    BufferStream.prototype.writeFloatBE = BufferStream._write_gen('writeFloatBE', 4);","coverage":1},"358":{"line":"","coverage":""},"359":{"line":"    BufferStream.prototype.writeDoubleLE = BufferStream._write_gen('writeDoubleLE', 8);","coverage":1},"360":{"line":"","coverage":""},"361":{"line":"    BufferStream.prototype.writeDoubleBE = BufferStream._write_gen('writeDoubleBE', 8);","coverage":1},"362":{"line":"","coverage":""},"363":{"line":"    return BufferStream;","coverage":1},"364":{"line":"","coverage":""},"365":{"line":"  })(stream.Writable);","coverage":""},"366":{"line":"","coverage":""},"367":{"line":"  module.exports = BufferStream;","coverage":1},"368":{"line":"","coverage":""},"369":{"line":"}).call(this);","coverage":""}}},{"filename":"cbor.js","coverage":100,"hits":10,"misses":0,"sloc":10,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  exports.Diagnose = require('./diagnose');","coverage":1},"4":{"line":"","coverage":""},"5":{"line":"  exports.Decoder = require('./decoder');","coverage":1},"6":{"line":"","coverage":""},"7":{"line":"  exports.Encoder = require('./encoder');","coverage":1},"8":{"line":"","coverage":""},"9":{"line":"  exports.Simple = require('./simple');","coverage":1},"10":{"line":"","coverage":""},"11":{"line":"  exports.Tagged = require('./tagged');","coverage":1},"12":{"line":"","coverage":""},"13":{"line":"  exports.Evented = require('./evented');","coverage":1},"14":{"line":"","coverage":""},"15":{"line":"  exports.encode = exports.Encoder.encode;","coverage":1},"16":{"line":"","coverage":""},"17":{"line":"  exports.decode = exports.Decoder.decode;","coverage":1},"18":{"line":"","coverage":""},"19":{"line":"  exports.diagnose = exports.Diagnose.diagnose;","coverage":1},"20":{"line":"","coverage":""},"21":{"line":"}).call(this);","coverage":""}}},{"filename":"diagnose.js","coverage":96.57534246575342,"hits":141,"misses":5,"sloc":146,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  var BufferStream, Diagnose, Evented, Simple, stream, utils,","coverage":1},"4":{"line":"    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },","coverage":1116},"5":{"line":"    __hasProp = {}.hasOwnProperty,","coverage":""},"6":{"line":"    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };","coverage":11},"7":{"line":"","coverage":""},"8":{"line":"  stream = require('stream');","coverage":1},"9":{"line":"","coverage":""},"10":{"line":"  Evented = require('./evented');","coverage":1},"11":{"line":"","coverage":""},"12":{"line":"  BufferStream = require('../lib/BufferStream');","coverage":1},"13":{"line":"","coverage":""},"14":{"line":"  Simple = require('../lib/simple');","coverage":1},"15":{"line":"","coverage":""},"16":{"line":"  utils = require('../lib/utils');","coverage":1},"17":{"line":"","coverage":""},"18":{"line":"  module.exports = Diagnose = (function(_super) {","coverage":1},"19":{"line":"    __extends(Diagnose, _super);","coverage":1},"20":{"line":"","coverage":""},"21":{"line":"    function Diagnose(options) {","coverage":1},"22":{"line":"      if (options == null) {","coverage":86},"23":{"line":"        options = {};","coverage":0},"24":{"line":"      }","coverage":""},"25":{"line":"      this._on_end = __bind(this._on_end, this);","coverage":86},"26":{"line":"      this._on_stream_stop = __bind(this._on_stream_stop, this);","coverage":86},"27":{"line":"      this._on_stream_start = __bind(this._on_stream_start, this);","coverage":86},"28":{"line":"      this._on_map_stop = __bind(this._on_map_stop, this);","coverage":86},"29":{"line":"      this._on_map_start = __bind(this._on_map_start, this);","coverage":86},"30":{"line":"      this._on_array_stop = __bind(this._on_array_stop, this);","coverage":86},"31":{"line":"      this._on_array_start = __bind(this._on_array_start, this);","coverage":86},"32":{"line":"      this._on_value = __bind(this._on_value, this);","coverage":86},"33":{"line":"      this._on_error = __bind(this._on_error, this);","coverage":86},"34":{"line":"      Diagnose.__super__.constructor.call(this);","coverage":86},"35":{"line":"      this.options = utils.extend({","coverage":86},"36":{"line":"        separator: '\\n',","coverage":""},"37":{"line":"        output: process.stdout","coverage":""},"38":{"line":"      }, options);","coverage":""},"39":{"line":"      this.parser = new Evented(this.options);","coverage":86},"40":{"line":"      this.parser.on('value', this._on_value);","coverage":86},"41":{"line":"      this.parser.on('array-start', this._on_array_start);","coverage":86},"42":{"line":"      this.parser.on('array-stop', this._on_array_stop);","coverage":86},"43":{"line":"      this.parser.on('map-start', this._on_map_start);","coverage":86},"44":{"line":"      this.parser.on('map-stop', this._on_map_stop);","coverage":86},"45":{"line":"      this.parser.on('stream-start', this._on_stream_start);","coverage":86},"46":{"line":"      this.parser.on('stream-stop', this._on_stream_stop);","coverage":86},"47":{"line":"      this.parser.on('end', this._on_end);","coverage":86},"48":{"line":"      this.parser.on('error', this._on_error);","coverage":86},"49":{"line":"    }","coverage":""},"50":{"line":"","coverage":""},"51":{"line":"    Diagnose.prototype.start = function() {","coverage":1},"52":{"line":"      return this.parser.start();","coverage":86},"53":{"line":"    };","coverage":""},"54":{"line":"","coverage":""},"55":{"line":"    Diagnose.diagnose = function(input, encoding, output, done) {","coverage":1},"56":{"line":"      var d;","coverage":1},"57":{"line":"      if (encoding == null) {","coverage":1},"58":{"line":"        encoding = 'hex';","coverage":1},"59":{"line":"      }","coverage":""},"60":{"line":"      if (output == null) {","coverage":1},"61":{"line":"        output = process.stdout;","coverage":0},"62":{"line":"      }","coverage":""},"63":{"line":"      d = new Diagnose({","coverage":1},"64":{"line":"        input: input,","coverage":""},"65":{"line":"        encoding: encoding,","coverage":""},"66":{"line":"        output: output","coverage":""},"67":{"line":"      });","coverage":""},"68":{"line":"      if (done) {","coverage":1},"69":{"line":"        d.on('end', done);","coverage":1},"70":{"line":"      }","coverage":""},"71":{"line":"      return d.start();","coverage":1},"72":{"line":"    };","coverage":""},"73":{"line":"","coverage":""},"74":{"line":"    Diagnose.prototype._stream_val = function(val) {","coverage":1},"75":{"line":"      return this.options.output.write((function() {","coverage":180},"76":{"line":"        switch (false) {","coverage":180},"77":{"line":"          case val !== void 0:","coverage":""},"78":{"line":"            return 'undefined';","coverage":1},"79":{"line":"          case val !== null:","coverage":""},"80":{"line":"            return 'nil';","coverage":1},"81":{"line":"          case typeof val !== 'number':","coverage":""},"82":{"line":"            if (isNaN(val)) {","coverage":131},"83":{"line":"              return \"NaN\";","coverage":3},"84":{"line":"            } else if (!isFinite(val)) {","coverage":128},"85":{"line":"              if (val &lt; 0) {","coverage":6},"86":{"line":"                return '-Infinity';","coverage":3},"87":{"line":"              } else {","coverage":""},"88":{"line":"                return 'Infinity';","coverage":3},"89":{"line":"              }","coverage":""},"90":{"line":"            } else {","coverage":""},"91":{"line":"              return JSON.stringify(val);","coverage":122},"92":{"line":"            }","coverage":""},"93":{"line":"            break;","coverage":0},"94":{"line":"          case !Simple.isSimple(val):","coverage":""},"95":{"line":"            return val.toString();","coverage":3},"96":{"line":"          case !Buffer.isBuffer(val):","coverage":""},"97":{"line":"            return \"h'\" + val.toString('hex') + \"'\";","coverage":10},"98":{"line":"          default:","coverage":""},"99":{"line":"            return JSON.stringify(val);","coverage":34},"100":{"line":"        }","coverage":""},"101":{"line":"      })());","coverage":""},"102":{"line":"    };","coverage":""},"103":{"line":"","coverage":""},"104":{"line":"    Diagnose.prototype._on_error = function(er) {","coverage":1},"105":{"line":"      if (this.options.streamErrors) {","coverage":2},"106":{"line":"        this.options.output.write(er.toString());","coverage":0},"107":{"line":"      }","coverage":""},"108":{"line":"      return this.emit('error', er);","coverage":2},"109":{"line":"    };","coverage":""},"110":{"line":"","coverage":""},"111":{"line":"    Diagnose.prototype._fore = function(kind) {","coverage":1},"112":{"line":"      switch (kind) {","coverage":219},"113":{"line":"        case 'array':","coverage":""},"114":{"line":"        case 'key':","coverage":""},"115":{"line":"        case 'stream':","coverage":""},"116":{"line":"          return this.options.output.write(', ');","coverage":86},"117":{"line":"      }","coverage":""},"118":{"line":"    };","coverage":""},"119":{"line":"","coverage":""},"120":{"line":"    Diagnose.prototype._aft = function(kind) {","coverage":1},"121":{"line":"      switch (kind) {","coverage":217},"122":{"line":"        case 'key':","coverage":""},"123":{"line":"        case 'key-first':","coverage":""},"124":{"line":"          return this.options.output.write(': ');","coverage":14},"125":{"line":"        case null:","coverage":""},"126":{"line":"          if (this.options.separator != null) {","coverage":84},"127":{"line":"            this.options.output.write(this.options.separator);","coverage":1},"128":{"line":"          }","coverage":""},"129":{"line":"          return this.emit('complete', this.options.output);","coverage":84},"130":{"line":"      }","coverage":""},"131":{"line":"    };","coverage":""},"132":{"line":"","coverage":""},"133":{"line":"    Diagnose.prototype._on_value = function(val, tags, kind) {","coverage":1},"134":{"line":"      var t, _i, _j, _len, _len1;","coverage":180},"135":{"line":"      this._fore(kind);","coverage":180},"136":{"line":"      if (tags) {","coverage":180},"137":{"line":"        for (_i = 0, _len = tags.length; _i &lt; _len; _i++) {","coverage":180},"138":{"line":"          t = tags[_i];","coverage":8},"139":{"line":"          this.options.output.write(\"\" + t + \"(\");","coverage":8},"140":{"line":"        }","coverage":""},"141":{"line":"      }","coverage":""},"142":{"line":"      this._stream_val(val);","coverage":180},"143":{"line":"      if (tags) {","coverage":180},"144":{"line":"        for (_j = 0, _len1 = tags.length; _j &lt; _len1; _j++) {","coverage":180},"145":{"line":"          t = tags[_j];","coverage":8},"146":{"line":"          this.options.output.write(\")\");","coverage":8},"147":{"line":"        }","coverage":""},"148":{"line":"      }","coverage":""},"149":{"line":"      return this._aft(kind);","coverage":180},"150":{"line":"    };","coverage":""},"151":{"line":"","coverage":""},"152":{"line":"    Diagnose.prototype._on_array_start = function(count, tags, kind) {","coverage":1},"153":{"line":"      var t, _i, _len;","coverage":28},"154":{"line":"      this._fore(kind);","coverage":28},"155":{"line":"      if (tags) {","coverage":28},"156":{"line":"        for (_i = 0, _len = tags.length; _i &lt; _len; _i++) {","coverage":28},"157":{"line":"          t = tags[_i];","coverage":3},"158":{"line":"          this.options.output.write(\"\" + t + \"(\");","coverage":3},"159":{"line":"        }","coverage":""},"160":{"line":"      }","coverage":""},"161":{"line":"      this.options.output.write(\"[\");","coverage":28},"162":{"line":"      if (count === -1) {","coverage":28},"163":{"line":"        return this.options.output.write(\"_ \");","coverage":9},"164":{"line":"      }","coverage":""},"165":{"line":"    };","coverage":""},"166":{"line":"","coverage":""},"167":{"line":"    Diagnose.prototype._on_array_stop = function(count, tags, kind) {","coverage":1},"168":{"line":"      var t, _i, _len;","coverage":26},"169":{"line":"      this.options.output.write(\"]\");","coverage":26},"170":{"line":"      if (tags) {","coverage":26},"171":{"line":"        for (_i = 0, _len = tags.length; _i &lt; _len; _i++) {","coverage":26},"172":{"line":"          t = tags[_i];","coverage":3},"173":{"line":"          this.options.output.write(\")\");","coverage":3},"174":{"line":"        }","coverage":""},"175":{"line":"      }","coverage":""},"176":{"line":"      return this._aft(kind);","coverage":26},"177":{"line":"    };","coverage":""},"178":{"line":"","coverage":""},"179":{"line":"    Diagnose.prototype._on_map_start = function(count, tags, kind) {","coverage":1},"180":{"line":"      var t, _i, _len;","coverage":8},"181":{"line":"      this._fore(kind);","coverage":8},"182":{"line":"      if (tags) {","coverage":8},"183":{"line":"        for (_i = 0, _len = tags.length; _i &lt; _len; _i++) {","coverage":8},"184":{"line":"          t = tags[_i];","coverage":1},"185":{"line":"          this.options.output.write(\"\" + t + \"(\");","coverage":1},"186":{"line":"        }","coverage":""},"187":{"line":"      }","coverage":""},"188":{"line":"      this.options.output.write(\"{\");","coverage":8},"189":{"line":"      if (count === -1) {","coverage":8},"190":{"line":"        return this.options.output.write(\"_ \");","coverage":2},"191":{"line":"      }","coverage":""},"192":{"line":"    };","coverage":""},"193":{"line":"","coverage":""},"194":{"line":"    Diagnose.prototype._on_map_stop = function(count, tags, kind) {","coverage":1},"195":{"line":"      var t, _i, _len;","coverage":8},"196":{"line":"      this.options.output.write(\"}\");","coverage":8},"197":{"line":"      if (tags) {","coverage":8},"198":{"line":"        for (_i = 0, _len = tags.length; _i &lt; _len; _i++) {","coverage":8},"199":{"line":"          t = tags[_i];","coverage":1},"200":{"line":"          this.options.output.write(\")\");","coverage":1},"201":{"line":"        }","coverage":""},"202":{"line":"      }","coverage":""},"203":{"line":"      return this._aft(kind);","coverage":8},"204":{"line":"    };","coverage":""},"205":{"line":"","coverage":""},"206":{"line":"    Diagnose.prototype._on_stream_start = function(mt, tags, kind) {","coverage":1},"207":{"line":"      var t, _i, _len;","coverage":3},"208":{"line":"      this._fore(kind);","coverage":3},"209":{"line":"      if (tags) {","coverage":3},"210":{"line":"        for (_i = 0, _len = tags.length; _i &lt; _len; _i++) {","coverage":3},"211":{"line":"          t = tags[_i];","coverage":1},"212":{"line":"          this.options.output.write(\"\" + t + \"(\");","coverage":1},"213":{"line":"        }","coverage":""},"214":{"line":"      }","coverage":""},"215":{"line":"      return this.options.output.write(\"(_ \");","coverage":3},"216":{"line":"    };","coverage":""},"217":{"line":"","coverage":""},"218":{"line":"    Diagnose.prototype._on_stream_stop = function(count, mt, tags, kind) {","coverage":1},"219":{"line":"      var t, _i, _len;","coverage":3},"220":{"line":"      this.options.output.write(\")\");","coverage":3},"221":{"line":"      if (tags) {","coverage":3},"222":{"line":"        for (_i = 0, _len = tags.length; _i &lt; _len; _i++) {","coverage":3},"223":{"line":"          t = tags[_i];","coverage":1},"224":{"line":"          this.options.output.write(\")\");","coverage":1},"225":{"line":"        }","coverage":""},"226":{"line":"      }","coverage":""},"227":{"line":"      return this._aft(kind);","coverage":3},"228":{"line":"    };","coverage":""},"229":{"line":"","coverage":""},"230":{"line":"    Diagnose.prototype._on_end = function() {","coverage":1},"231":{"line":"      return this.emit('end');","coverage":84},"232":{"line":"    };","coverage":""},"233":{"line":"","coverage":""},"234":{"line":"    Diagnose.prototype._write = function(chunk, enc, next) {","coverage":1},"235":{"line":"      return this.parser.write(chunk, enc, next);","coverage":0},"236":{"line":"    };","coverage":""},"237":{"line":"","coverage":""},"238":{"line":"    return Diagnose;","coverage":1},"239":{"line":"","coverage":""},"240":{"line":"  })(stream.Writable);","coverage":""},"241":{"line":"","coverage":""},"242":{"line":"}).call(this);","coverage":""}}},{"filename":"evented.js","coverage":96.3265306122449,"hits":236,"misses":9,"sloc":245,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  var BREAK, BufferStream, Evented, MT, Simple, assert, async, constants, stream, utils,","coverage":1},"4":{"line":"    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },","coverage":530},"5":{"line":"    __hasProp = {}.hasOwnProperty,","coverage":""},"6":{"line":"    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };","coverage":11},"7":{"line":"","coverage":""},"8":{"line":"  assert = require('assert');","coverage":1},"9":{"line":"","coverage":""},"10":{"line":"  stream = require('stream');","coverage":1},"11":{"line":"","coverage":""},"12":{"line":"  async = require('async');","coverage":1},"13":{"line":"","coverage":""},"14":{"line":"  BufferStream = require('../lib/BufferStream');","coverage":1},"15":{"line":"","coverage":""},"16":{"line":"  utils = require('../lib/utils');","coverage":1},"17":{"line":"","coverage":""},"18":{"line":"  Simple = require('../lib/simple');","coverage":1},"19":{"line":"","coverage":""},"20":{"line":"  constants = require('./constants');","coverage":1},"21":{"line":"","coverage":""},"22":{"line":"  MT = constants.MT;","coverage":1},"23":{"line":"","coverage":""},"24":{"line":"  BREAK = function() {","coverage":1},"25":{"line":"    return \"BREAK\";","coverage":0},"26":{"line":"  };","coverage":""},"27":{"line":"","coverage":""},"28":{"line":"  module.exports = Evented = (function(_super) {","coverage":1},"29":{"line":"    __extends(Evented, _super);","coverage":1},"30":{"line":"","coverage":""},"31":{"line":"    function Evented(options) {","coverage":1},"32":{"line":"      this._pump = __bind(this._pump, this);","coverage":177},"33":{"line":"      var input;","coverage":177},"34":{"line":"      Evented.__super__.constructor.call(this);","coverage":177},"35":{"line":"      this.options = utils.extend({","coverage":177},"36":{"line":"        max_depth: 512,","coverage":""},"37":{"line":"        input: null,","coverage":""},"38":{"line":"        offset: 0,","coverage":""},"39":{"line":"        encoding: 'hex'","coverage":""},"40":{"line":"      }, options);","coverage":""},"41":{"line":"      this.bs = null;","coverage":177},"42":{"line":"      this.tags = [];","coverage":177},"43":{"line":"      this.kind = null;","coverage":177},"44":{"line":"      this.depth = 0;","coverage":177},"45":{"line":"      this.on('finish', function() {","coverage":177},"46":{"line":"        return this.bs.end();","coverage":2},"47":{"line":"      });","coverage":""},"48":{"line":"      if (this.options.input != null) {","coverage":177},"49":{"line":"        input = this.options.input;","coverage":175},"50":{"line":"        if (Buffer.isBuffer(input)) {","coverage":175},"51":{"line":"          if (this.options.offset) {","coverage":1},"52":{"line":"            input = input.slice(this.options.offset);","coverage":1},"53":{"line":"          }","coverage":""},"54":{"line":"          this.bs = new BufferStream({","coverage":1},"55":{"line":"            bsInit: input","coverage":""},"56":{"line":"          });","coverage":""},"57":{"line":"        } else if (typeof input === 'string') {","coverage":174},"58":{"line":"          if (this.options.encoding === 'hex') {","coverage":173},"59":{"line":"            input = input.replace(/^0x/, '');","coverage":173},"60":{"line":"          }","coverage":""},"61":{"line":"          if (this.options.offset) {","coverage":173},"62":{"line":"            input = input.slice(this.options.offset);","coverage":1},"63":{"line":"          }","coverage":""},"64":{"line":"          this.bs = new BufferStream({","coverage":173},"65":{"line":"            bsInit: new Buffer(input, this.options.encoding)","coverage":""},"66":{"line":"          });","coverage":""},"67":{"line":"        } else if (!BufferStream.isBufferStream(input)) {","coverage":1},"68":{"line":"          throw new Error(\"input must be Buffer, string, or BufferStream\");","coverage":1},"69":{"line":"        }","coverage":""},"70":{"line":"        this._start;","coverage":174},"71":{"line":"      } else {","coverage":""},"72":{"line":"        this.bs = new BufferStream;","coverage":2},"73":{"line":"        this._pump();","coverage":2},"74":{"line":"      }","coverage":""},"75":{"line":"    }","coverage":""},"76":{"line":"","coverage":""},"77":{"line":"    Evented.prototype.start = function() {","coverage":1},"78":{"line":"      return this._pump();","coverage":174},"79":{"line":"    };","coverage":""},"80":{"line":"","coverage":""},"81":{"line":"    Evented.prototype._write = function(chunk, enc, next) {","coverage":1},"82":{"line":"      return this.bs.write(chunk, enc, next);","coverage":2},"83":{"line":"    };","coverage":""},"84":{"line":"","coverage":""},"85":{"line":"    Evented.prototype._drainState = function() {","coverage":1},"86":{"line":"      var kind, tags, _ref;","coverage":476},"87":{"line":"      tags = this.tags.slice();","coverage":476},"88":{"line":"      this.tags.length = 0;","coverage":476},"89":{"line":"      _ref = [null, this.kind], this.kind = _ref[0], kind = _ref[1];","coverage":476},"90":{"line":"      return [tags, kind];","coverage":476},"91":{"line":"    };","coverage":""},"92":{"line":"","coverage":""},"93":{"line":"    Evented.prototype._val = function(val, cb) {","coverage":1},"94":{"line":"      var kind, tags, _ref;","coverage":368},"95":{"line":"      _ref = this._drainState(), tags = _ref[0], kind = _ref[1];","coverage":368},"96":{"line":"      this.emit('value', val, tags, kind);","coverage":368},"97":{"line":"      return cb.call(this, null, val);","coverage":368},"98":{"line":"    };","coverage":""},"99":{"line":"","coverage":""},"100":{"line":"    Evented.prototype._readBuf = function(len, cb) {","coverage":1},"101":{"line":"      return this.bs.wait(len, (function(_this) {","coverage":17},"102":{"line":"        return function(er, buf) {","coverage":17},"103":{"line":"          if (er) {","coverage":17},"104":{"line":"            return cb.call(_this, er);","coverage":1},"105":{"line":"          }","coverage":""},"106":{"line":"          return _this._val(buf, cb);","coverage":16},"107":{"line":"        };","coverage":""},"108":{"line":"      })(this));","coverage":""},"109":{"line":"    };","coverage":""},"110":{"line":"","coverage":""},"111":{"line":"    Evented.prototype._readStr = function(len, cb) {","coverage":1},"112":{"line":"      return this.bs.wait(len, (function(_this) {","coverage":71},"113":{"line":"        return function(er, buf) {","coverage":71},"114":{"line":"          if (er) {","coverage":71},"115":{"line":"            return cb.call(_this, er);","coverage":3},"116":{"line":"          }","coverage":""},"117":{"line":"          return _this._val(buf.toString('utf8'), cb);","coverage":68},"118":{"line":"        };","coverage":""},"119":{"line":"      })(this));","coverage":""},"120":{"line":"    };","coverage":""},"121":{"line":"","coverage":""},"122":{"line":"    Evented.prototype._readArray = function(count, cb) {","coverage":1},"123":{"line":"      var kind, tags, _ref;","coverage":39},"124":{"line":"      _ref = this._drainState(), tags = _ref[0], kind = _ref[1];","coverage":39},"125":{"line":"      this.emit('array-start', count, tags, kind);","coverage":39},"126":{"line":"      return async.timesSeries(count, (function(_this) {","coverage":39},"127":{"line":"        return function(n, done) {","coverage":39},"128":{"line":"          _this.kind = n ? 'array' : 'array-first';","coverage":127},"129":{"line":"          return _this._unpack(done);","coverage":127},"130":{"line":"        };","coverage":""},"131":{"line":"      })(this), (function(_this) {","coverage":""},"132":{"line":"        return function(er) {","coverage":39},"133":{"line":"          if (er) {","coverage":39},"134":{"line":"            return cb.call(_this, er);","coverage":2},"135":{"line":"          }","coverage":""},"136":{"line":"          _this.emit('array-stop', count, tags, kind);","coverage":37},"137":{"line":"          _this.mt = MT.ARRAY;","coverage":37},"138":{"line":"          return cb.call(_this);","coverage":37},"139":{"line":"        };","coverage":""},"140":{"line":"      })(this));","coverage":""},"141":{"line":"    };","coverage":""},"142":{"line":"","coverage":""},"143":{"line":"    Evented.prototype._readMap = function(count, cb) {","coverage":1},"144":{"line":"      var kind, tags, up, _ref;","coverage":12},"145":{"line":"      _ref = this._drainState(), tags = _ref[0], kind = _ref[1];","coverage":12},"146":{"line":"      this.emit('map-start', count, tags, kind);","coverage":12},"147":{"line":"      up = this._unpack.bind(this);","coverage":12},"148":{"line":"      return async.timesSeries(count, (function(_this) {","coverage":12},"149":{"line":"        return function(n, done) {","coverage":12},"150":{"line":"          return async.series([","coverage":23},"151":{"line":"            function(cb) {","coverage":""},"152":{"line":"              _this.kind = n ? 'key' : 'key-first';","coverage":23},"153":{"line":"              return up(cb);","coverage":23},"154":{"line":"            }, function(cb) {","coverage":""},"155":{"line":"              _this.kind = 'value';","coverage":22},"156":{"line":"              return up(cb);","coverage":22},"157":{"line":"            }","coverage":""},"158":{"line":"          ], done);","coverage":""},"159":{"line":"        };","coverage":""},"160":{"line":"      })(this), (function(_this) {","coverage":""},"161":{"line":"        return function(er) {","coverage":12},"162":{"line":"          if (er) {","coverage":12},"163":{"line":"            return cb.call(_this, er);","coverage":1},"164":{"line":"          }","coverage":""},"165":{"line":"          _this.emit('map-stop', count, tags, kind);","coverage":11},"166":{"line":"          _this.mt = MT.MAP;","coverage":11},"167":{"line":"          return cb.call(_this);","coverage":11},"168":{"line":"        };","coverage":""},"169":{"line":"      })(this));","coverage":""},"170":{"line":"    };","coverage":""},"171":{"line":"","coverage":""},"172":{"line":"    Evented.prototype._readTag = function(val, cb) {","coverage":1},"173":{"line":"      this.tags.push(val);","coverage":28},"174":{"line":"      return this._unpack(cb);","coverage":28},"175":{"line":"    };","coverage":""},"176":{"line":"","coverage":""},"177":{"line":"    Evented.prototype._readSimple = function(val, cb) {","coverage":1},"178":{"line":"      switch (val) {","coverage":15},"179":{"line":"        case 20:","coverage":""},"180":{"line":"          return this._val(false, cb);","coverage":2},"181":{"line":"        case 21:","coverage":""},"182":{"line":"          return this._val(true, cb);","coverage":3},"183":{"line":"        case 22:","coverage":""},"184":{"line":"          return this._val(null, cb);","coverage":2},"185":{"line":"        case 23:","coverage":""},"186":{"line":"          return this._val(void 0, cb);","coverage":2},"187":{"line":"        default:","coverage":""},"188":{"line":"          return this._val(new Simple(val), cb);","coverage":6},"189":{"line":"      }","coverage":""},"190":{"line":"    };","coverage":""},"191":{"line":"","coverage":""},"192":{"line":"    Evented.prototype._getVal = function(val, cb) {","coverage":1},"193":{"line":"      switch (this.mt) {","coverage":404},"194":{"line":"        case MT.POS_INT:","coverage":""},"195":{"line":"          return this._val(val, cb);","coverage":214},"196":{"line":"        case MT.NEG_INT:","coverage":""},"197":{"line":"          return this._val(-1 - val, cb);","coverage":12},"198":{"line":"        case MT.BYTE_STRING:","coverage":""},"199":{"line":"          return this._readBuf(val, cb);","coverage":17},"200":{"line":"        case MT.UTF8_STRING:","coverage":""},"201":{"line":"          return this._readStr(val, cb);","coverage":71},"202":{"line":"        case MT.ARRAY:","coverage":""},"203":{"line":"          return this._readArray(val, cb);","coverage":39},"204":{"line":"        case MT.MAP:","coverage":""},"205":{"line":"          return this._readMap(val, cb);","coverage":12},"206":{"line":"        case MT.TAG:","coverage":""},"207":{"line":"          return this._readTag(val, cb);","coverage":28},"208":{"line":"        case MT.SIMPLE_FLOAT:","coverage":""},"209":{"line":"          return this._readSimple(val, cb);","coverage":11},"210":{"line":"        default:","coverage":""},"211":{"line":"          return cb.call(this, new Error(\"Unknown major type(\" + this.mt + \"): \" + val));","coverage":0},"212":{"line":"      }","coverage":""},"213":{"line":"    };","coverage":""},"214":{"line":"","coverage":""},"215":{"line":"    Evented.prototype._stream_stringy = function(cb) {","coverage":1},"216":{"line":"      var count, keep_going, kind, mt, tags, _ref;","coverage":7},"217":{"line":"      mt = this.mt;","coverage":7},"218":{"line":"      _ref = this._drainState(), tags = _ref[0], kind = _ref[1];","coverage":7},"219":{"line":"      count = 0;","coverage":7},"220":{"line":"      this.emit('stream-start', mt, tags, kind);","coverage":7},"221":{"line":"      keep_going = true;","coverage":7},"222":{"line":"      return async.doWhilst((function(_this) {","coverage":7},"223":{"line":"        return function(done) {","coverage":7},"224":{"line":"          _this.kind = count ? 'stream' : 'stream-first';","coverage":22},"225":{"line":"          return _this._unpack(function(er, val) {","coverage":22},"226":{"line":"            if (er) {","coverage":22},"227":{"line":"              return done(er);","coverage":1},"228":{"line":"            }","coverage":""},"229":{"line":"            if (val === BREAK) {","coverage":21},"230":{"line":"              keep_going = false;","coverage":6},"231":{"line":"            } else {","coverage":""},"232":{"line":"              if (_this.mt !== mt) {","coverage":15},"233":{"line":"                return done(new Error(\"Invalid stream major type: \" + _this.mt + \", when anticipating only \" + mt));","coverage":0},"234":{"line":"              }","coverage":""},"235":{"line":"              count++;","coverage":15},"236":{"line":"            }","coverage":""},"237":{"line":"            return done();","coverage":21},"238":{"line":"          });","coverage":""},"239":{"line":"        };","coverage":""},"240":{"line":"      })(this), function() {","coverage":""},"241":{"line":"        return keep_going;","coverage":21},"242":{"line":"      }, (function(_this) {","coverage":""},"243":{"line":"        return function(er) {","coverage":7},"244":{"line":"          if (er) {","coverage":7},"245":{"line":"            return cb.call(_this, er);","coverage":1},"246":{"line":"          }","coverage":""},"247":{"line":"          _this.emit('stream-stop', count, mt, tags, kind);","coverage":6},"248":{"line":"          return cb.call(_this);","coverage":6},"249":{"line":"        };","coverage":""},"250":{"line":"      })(this));","coverage":""},"251":{"line":"    };","coverage":""},"252":{"line":"","coverage":""},"253":{"line":"    Evented.prototype._stream_array = function(cb) {","coverage":1},"254":{"line":"      var count, keep_going, kind, mt, tags, _ref;","coverage":18},"255":{"line":"      mt = this.mt;","coverage":18},"256":{"line":"      _ref = this._drainState(), tags = _ref[0], kind = _ref[1];","coverage":18},"257":{"line":"      count = 0;","coverage":18},"258":{"line":"      this.emit('array-start', -1, tags, kind);","coverage":18},"259":{"line":"      keep_going = true;","coverage":18},"260":{"line":"      return async.doWhilst((function(_this) {","coverage":18},"261":{"line":"        return function(done) {","coverage":18},"262":{"line":"          _this.kind = count ? 'array' : 'array-first';","coverage":97},"263":{"line":"          return _this._unpack(function(er, val) {","coverage":97},"264":{"line":"            if (er) {","coverage":97},"265":{"line":"              return done(er);","coverage":0},"266":{"line":"            }","coverage":""},"267":{"line":"            if (val === BREAK) {","coverage":97},"268":{"line":"              keep_going = false;","coverage":18},"269":{"line":"            } else {","coverage":""},"270":{"line":"              count++;","coverage":79},"271":{"line":"            }","coverage":""},"272":{"line":"            return done();","coverage":97},"273":{"line":"          });","coverage":""},"274":{"line":"        };","coverage":""},"275":{"line":"      })(this), function() {","coverage":""},"276":{"line":"        return keep_going;","coverage":97},"277":{"line":"      }, (function(_this) {","coverage":""},"278":{"line":"        return function(er) {","coverage":18},"279":{"line":"          if (er) {","coverage":18},"280":{"line":"            return cb.call(_this, er);","coverage":0},"281":{"line":"          }","coverage":""},"282":{"line":"          _this.emit('array-stop', count, tags, kind);","coverage":18},"283":{"line":"          return cb.call(_this);","coverage":18},"284":{"line":"        };","coverage":""},"285":{"line":"      })(this));","coverage":""},"286":{"line":"    };","coverage":""},"287":{"line":"","coverage":""},"288":{"line":"    Evented.prototype._stream_map = function(cb) {","coverage":1},"289":{"line":"      var count, keep_going, kind, mt, tags, _ref;","coverage":4},"290":{"line":"      mt = this.mt;","coverage":4},"291":{"line":"      _ref = this._drainState(), tags = _ref[0], kind = _ref[1];","coverage":4},"292":{"line":"      count = 0;","coverage":4},"293":{"line":"      this.emit('map-start', -1, tags, kind);","coverage":4},"294":{"line":"      keep_going = true;","coverage":4},"295":{"line":"      return async.doWhilst((function(_this) {","coverage":4},"296":{"line":"        return function(done) {","coverage":4},"297":{"line":"          _this.kind = count ? 'key' : 'key-first';","coverage":10},"298":{"line":"          return _this._unpack(function(er, val) {","coverage":10},"299":{"line":"            if (er) {","coverage":10},"300":{"line":"              return done(er);","coverage":0},"301":{"line":"            }","coverage":""},"302":{"line":"            if (val === BREAK) {","coverage":10},"303":{"line":"              keep_going = false;","coverage":4},"304":{"line":"              return done();","coverage":4},"305":{"line":"            } else {","coverage":""},"306":{"line":"              count++;","coverage":6},"307":{"line":"              this.kind = 'value';","coverage":6},"308":{"line":"              return this._unpack(done);","coverage":6},"309":{"line":"            }","coverage":""},"310":{"line":"          });","coverage":""},"311":{"line":"        };","coverage":""},"312":{"line":"      })(this), function() {","coverage":""},"313":{"line":"        return keep_going;","coverage":10},"314":{"line":"      }, (function(_this) {","coverage":""},"315":{"line":"        return function(er) {","coverage":4},"316":{"line":"          if (er) {","coverage":4},"317":{"line":"            return cb.call(_this, er);","coverage":0},"318":{"line":"          }","coverage":""},"319":{"line":"          _this.emit('map-stop', count, tags, kind);","coverage":4},"320":{"line":"          return cb.call(_this);","coverage":4},"321":{"line":"        };","coverage":""},"322":{"line":"      })(this));","coverage":""},"323":{"line":"    };","coverage":""},"324":{"line":"","coverage":""},"325":{"line":"    Evented.prototype._stream = function(cb) {","coverage":1},"326":{"line":"      var kind, tags, _ref;","coverage":57},"327":{"line":"      switch (this.mt) {","coverage":57},"328":{"line":"        case MT.BYTE_STRING:","coverage":""},"329":{"line":"        case MT.UTF8_STRING:","coverage":""},"330":{"line":"          return this._stream_stringy(cb);","coverage":7},"331":{"line":"        case MT.ARRAY:","coverage":""},"332":{"line":"          return this._stream_array(cb);","coverage":18},"333":{"line":"        case MT.MAP:","coverage":""},"334":{"line":"          return this._stream_map(cb);","coverage":4},"335":{"line":"        case MT.SIMPLE_FLOAT:","coverage":""},"336":{"line":"          _ref = this._drainState(), tags = _ref[0], kind = _ref[1];","coverage":28},"337":{"line":"          return cb.call(this, null, BREAK);","coverage":28},"338":{"line":"        default:","coverage":""},"339":{"line":"          return cb.call(this, new Error(\"Invalid stream major type: \" + this.mt));","coverage":0},"340":{"line":"      }","coverage":""},"341":{"line":"    };","coverage":""},"342":{"line":"","coverage":""},"343":{"line":"    Evented.prototype._unpack = function(cb) {","coverage":1},"344":{"line":"      return this.bs.wait(1, (function(_this) {","coverage":512},"345":{"line":"        return function(er, buf) {","coverage":512},"346":{"line":"          var decrement;","coverage":512},"347":{"line":"          if (er) {","coverage":512},"348":{"line":"            return cb(er);","coverage":2},"349":{"line":"          }","coverage":""},"350":{"line":"          _this.depth++;","coverage":510},"351":{"line":"          if (_this.depth &gt; _this.options.max_depth) {","coverage":510},"352":{"line":"            return cb.call(_this, new Error(\"Maximum depth exceeded: \" + _this.depth));","coverage":1},"353":{"line":"          }","coverage":""},"354":{"line":"          _this.octet = buf[0];","coverage":509},"355":{"line":"          _this.mt = _this.octet &gt;&gt; 5;","coverage":509},"356":{"line":"          _this.ai = _this.octet &amp; 0x1f;","coverage":509},"357":{"line":"          decrement = function(er) {","coverage":509},"358":{"line":"            if (!(er instanceof Error)) {","coverage":508},"359":{"line":"              _this.depth--;","coverage":500},"360":{"line":"            }","coverage":""},"361":{"line":"            return cb.apply(_this, arguments);","coverage":508},"362":{"line":"          };","coverage":""},"363":{"line":"          switch (_this.ai) {","coverage":509},"364":{"line":"            case 24:","coverage":""},"365":{"line":"            case 25:","coverage":""},"366":{"line":"            case 26:","coverage":""},"367":{"line":"            case 27:","coverage":""},"368":{"line":"              return _this.bs.wait(1 &lt;&lt; (_this.ai - 24), function(er, buf) {","coverage":83},"369":{"line":"                if (er) {","coverage":83},"370":{"line":"                  return cb(er);","coverage":0},"371":{"line":"                }","coverage":""},"372":{"line":"                if (_this.mt === MT.SIMPLE_FLOAT) {","coverage":83},"373":{"line":"                  if (_this.ai === 24) {","coverage":47},"374":{"line":"                    return _this._readSimple(utils.parseInt(_this.ai, buf), decrement);","coverage":4},"375":{"line":"                  } else {","coverage":""},"376":{"line":"                    return _this._val(utils.parseFloat(_this.ai, buf), decrement);","coverage":43},"377":{"line":"                  }","coverage":""},"378":{"line":"                } else {","coverage":""},"379":{"line":"                  return _this._getVal(utils.parseInt(_this.ai, buf), decrement);","coverage":36},"380":{"line":"                }","coverage":""},"381":{"line":"              });","coverage":""},"382":{"line":"            case 28:","coverage":""},"383":{"line":"            case 29:","coverage":""},"384":{"line":"            case 30:","coverage":""},"385":{"line":"              return cb(new Error(\"Additional info not implemented: \" + _this.ai));","coverage":1},"386":{"line":"            case 31:","coverage":""},"387":{"line":"              return _this._stream(decrement);","coverage":57},"388":{"line":"            default:","coverage":""},"389":{"line":"              return _this._getVal(_this.ai, decrement);","coverage":368},"390":{"line":"          }","coverage":""},"391":{"line":"        };","coverage":""},"392":{"line":"      })(this));","coverage":""},"393":{"line":"    };","coverage":""},"394":{"line":"","coverage":""},"395":{"line":"    Evented.prototype._pump = function(er) {","coverage":1},"396":{"line":"      if (er) {","coverage":353},"397":{"line":"        if (BufferStream.isEOFError(er) &amp;&amp; (this.depth === 0)) {","coverage":8},"398":{"line":"          return this.emit('end');","coverage":1},"399":{"line":"        } else {","coverage":""},"400":{"line":"          return this.emit('error', er);","coverage":7},"401":{"line":"        }","coverage":""},"402":{"line":"      }","coverage":""},"403":{"line":"      return async.nextTick((function(_this) {","coverage":345},"404":{"line":"        return function() {","coverage":345},"405":{"line":"          if (_this.bs.isEOF()) {","coverage":345},"406":{"line":"            return _this.emit('end');","coverage":168},"407":{"line":"          } else {","coverage":""},"408":{"line":"            return _this._unpack(_this._pump);","coverage":177},"409":{"line":"          }","coverage":""},"410":{"line":"        };","coverage":""},"411":{"line":"      })(this));","coverage":""},"412":{"line":"    };","coverage":""},"413":{"line":"","coverage":""},"414":{"line":"    return Evented;","coverage":1},"415":{"line":"","coverage":""},"416":{"line":"  })(stream.Writable);","coverage":""},"417":{"line":"","coverage":""},"418":{"line":"}).call(this);","coverage":""}}},{"filename":"constants.js","coverage":100,"hits":50,"misses":0,"sloc":50,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  var MT, NUM_BYTES, SIMPLE, TAG;","coverage":1},"4":{"line":"","coverage":""},"5":{"line":"  MT = (function() {","coverage":1},"6":{"line":"    function MT() {}","coverage":1},"7":{"line":"","coverage":""},"8":{"line":"    MT.POS_INT = 0;","coverage":1},"9":{"line":"","coverage":""},"10":{"line":"    MT.NEG_INT = 1;","coverage":1},"11":{"line":"","coverage":""},"12":{"line":"    MT.BYTE_STRING = 2;","coverage":1},"13":{"line":"","coverage":""},"14":{"line":"    MT.UTF8_STRING = 3;","coverage":1},"15":{"line":"","coverage":""},"16":{"line":"    MT.ARRAY = 4;","coverage":1},"17":{"line":"","coverage":""},"18":{"line":"    MT.MAP = 5;","coverage":1},"19":{"line":"","coverage":""},"20":{"line":"    MT.TAG = 6;","coverage":1},"21":{"line":"","coverage":""},"22":{"line":"    MT.SIMPLE_FLOAT = 7;","coverage":1},"23":{"line":"","coverage":""},"24":{"line":"    return MT;","coverage":1},"25":{"line":"","coverage":""},"26":{"line":"  })();","coverage":""},"27":{"line":"","coverage":""},"28":{"line":"  exports.MT = MT;","coverage":1},"29":{"line":"","coverage":""},"30":{"line":"  TAG = (function() {","coverage":1},"31":{"line":"    function TAG() {}","coverage":1},"32":{"line":"","coverage":""},"33":{"line":"    TAG.DATE_STRING = 0;","coverage":1},"34":{"line":"","coverage":""},"35":{"line":"    TAG.DATE_EPOCH = 1;","coverage":1},"36":{"line":"","coverage":""},"37":{"line":"    TAG.POS_BIGINT = 2;","coverage":1},"38":{"line":"","coverage":""},"39":{"line":"    TAG.NEG_BIGINT = 3;","coverage":1},"40":{"line":"","coverage":""},"41":{"line":"    TAG.DECIMAL_FRAC = 4;","coverage":1},"42":{"line":"","coverage":""},"43":{"line":"    TAG.BIGFLOAT = 5;","coverage":1},"44":{"line":"","coverage":""},"45":{"line":"    TAG.BASE64URL_EXPECTED = 21;","coverage":1},"46":{"line":"","coverage":""},"47":{"line":"    TAG.BASE64_EXPECTED = 22;","coverage":1},"48":{"line":"","coverage":""},"49":{"line":"    TAG.BASE16_EXPECTED = 23;","coverage":1},"50":{"line":"","coverage":""},"51":{"line":"    TAG.CBOR = 24;","coverage":1},"52":{"line":"","coverage":""},"53":{"line":"    TAG.URI = 32;","coverage":1},"54":{"line":"","coverage":""},"55":{"line":"    TAG.BASE64URL = 33;","coverage":1},"56":{"line":"","coverage":""},"57":{"line":"    TAG.BASE64 = 34;","coverage":1},"58":{"line":"","coverage":""},"59":{"line":"    TAG.REGEXP = 35;","coverage":1},"60":{"line":"","coverage":""},"61":{"line":"    TAG.MIME = 36;","coverage":1},"62":{"line":"","coverage":""},"63":{"line":"    return TAG;","coverage":1},"64":{"line":"","coverage":""},"65":{"line":"  })();","coverage":""},"66":{"line":"","coverage":""},"67":{"line":"  exports.TAG = TAG;","coverage":1},"68":{"line":"","coverage":""},"69":{"line":"  NUM_BYTES = (function() {","coverage":1},"70":{"line":"    function NUM_BYTES() {}","coverage":1},"71":{"line":"","coverage":""},"72":{"line":"    NUM_BYTES.ZERO = 0;","coverage":1},"73":{"line":"","coverage":""},"74":{"line":"    NUM_BYTES.ONE = 24;","coverage":1},"75":{"line":"","coverage":""},"76":{"line":"    NUM_BYTES.TWO = 25;","coverage":1},"77":{"line":"","coverage":""},"78":{"line":"    NUM_BYTES.FOUR = 26;","coverage":1},"79":{"line":"","coverage":""},"80":{"line":"    NUM_BYTES.EIGHT = 27;","coverage":1},"81":{"line":"","coverage":""},"82":{"line":"    return NUM_BYTES;","coverage":1},"83":{"line":"","coverage":""},"84":{"line":"  })();","coverage":""},"85":{"line":"","coverage":""},"86":{"line":"  exports.NUM_BYTES = NUM_BYTES;","coverage":1},"87":{"line":"","coverage":""},"88":{"line":"  SIMPLE = (function() {","coverage":1},"89":{"line":"    function SIMPLE() {}","coverage":1},"90":{"line":"","coverage":""},"91":{"line":"    SIMPLE.FALSE = 20;","coverage":1},"92":{"line":"","coverage":""},"93":{"line":"    SIMPLE.TRUE = 21;","coverage":1},"94":{"line":"","coverage":""},"95":{"line":"    SIMPLE.NULL = 22;","coverage":1},"96":{"line":"","coverage":""},"97":{"line":"    SIMPLE.UNDEFINED = 23;","coverage":1},"98":{"line":"","coverage":""},"99":{"line":"    return SIMPLE;","coverage":1},"100":{"line":"","coverage":""},"101":{"line":"  })();","coverage":""},"102":{"line":"","coverage":""},"103":{"line":"  exports.SIMPLE = SIMPLE;","coverage":1},"104":{"line":"","coverage":""},"105":{"line":"}).call(this);","coverage":""}}},{"filename":"decoder.js","coverage":98.57142857142858,"hits":138,"misses":2,"sloc":140,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  var BufferStream, DEFAULT_TAG_FUNCS, Decoder, Evented, MINUS_ONE, MT, TAG, TEN, TWO, Tagged, bignumber, constants, f, k, stream, url, utils, v,","coverage":1},"4":{"line":"    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },","coverage":1135},"5":{"line":"    __hasProp = {}.hasOwnProperty,","coverage":""},"6":{"line":"    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };","coverage":11},"7":{"line":"","coverage":""},"8":{"line":"  stream = require('stream');","coverage":1},"9":{"line":"","coverage":""},"10":{"line":"  url = require('url');","coverage":1},"11":{"line":"","coverage":""},"12":{"line":"  bignumber = require('bignumber.js');","coverage":1},"13":{"line":"","coverage":""},"14":{"line":"  BufferStream = require('../lib/BufferStream');","coverage":1},"15":{"line":"","coverage":""},"16":{"line":"  Tagged = require('../lib/tagged');","coverage":1},"17":{"line":"","coverage":""},"18":{"line":"  utils = require('../lib/utils');","coverage":1},"19":{"line":"","coverage":""},"20":{"line":"  Evented = require('./evented');","coverage":1},"21":{"line":"","coverage":""},"22":{"line":"  constants = require('./constants');","coverage":1},"23":{"line":"","coverage":""},"24":{"line":"  TAG = constants.TAG;","coverage":1},"25":{"line":"","coverage":""},"26":{"line":"  MT = constants.MT;","coverage":1},"27":{"line":"","coverage":""},"28":{"line":"  MINUS_ONE = new bignumber(-1);","coverage":1},"29":{"line":"","coverage":""},"30":{"line":"  TEN = new bignumber(10);","coverage":1},"31":{"line":"","coverage":""},"32":{"line":"  TWO = new bignumber(2);","coverage":1},"33":{"line":"","coverage":""},"34":{"line":"  DEFAULT_TAG_FUNCS = {};","coverage":1},"35":{"line":"","coverage":""},"36":{"line":"  module.exports = Decoder = (function(_super) {","coverage":1},"37":{"line":"    __extends(Decoder, _super);","coverage":1},"38":{"line":"","coverage":""},"39":{"line":"    function Decoder(options) {","coverage":1},"40":{"line":"      this.options = options != null ? options : {};","coverage":87},"41":{"line":"      this._on_end = __bind(this._on_end, this);","coverage":87},"42":{"line":"      this._on_stream_stop = __bind(this._on_stream_stop, this);","coverage":87},"43":{"line":"      this._on_stream_start = __bind(this._on_stream_start, this);","coverage":87},"44":{"line":"      this._on_map_stop = __bind(this._on_map_stop, this);","coverage":87},"45":{"line":"      this._on_map_start = __bind(this._on_map_start, this);","coverage":87},"46":{"line":"      this._on_array_stop = __bind(this._on_array_stop, this);","coverage":87},"47":{"line":"      this._on_array_start = __bind(this._on_array_start, this);","coverage":87},"48":{"line":"      this._on_value = __bind(this._on_value, this);","coverage":87},"49":{"line":"      this._on_error = __bind(this._on_error, this);","coverage":87},"50":{"line":"      Decoder.__super__.constructor.call(this);","coverage":87},"51":{"line":"      this.tags = utils.extend({}, DEFAULT_TAG_FUNCS, this.options.tags);","coverage":87},"52":{"line":"      this.stack = [];","coverage":87},"53":{"line":"      this.parser = new Evented({","coverage":87},"54":{"line":"        input: this.options.input","coverage":""},"55":{"line":"      });","coverage":""},"56":{"line":"      this.parser.on('value', this._on_value);","coverage":87},"57":{"line":"      this.parser.on('array-start', this._on_array_start);","coverage":87},"58":{"line":"      this.parser.on('array-stop', this._on_array_stop);","coverage":87},"59":{"line":"      this.parser.on('map-start', this._on_map_start);","coverage":87},"60":{"line":"      this.parser.on('map-stop', this._on_map_stop);","coverage":87},"61":{"line":"      this.parser.on('stream-start', this._on_stream_start);","coverage":87},"62":{"line":"      this.parser.on('stream-stop', this._on_stream_stop);","coverage":87},"63":{"line":"      this.parser.on('end', this._on_end);","coverage":87},"64":{"line":"      this.parser.on('error', this._on_error);","coverage":87},"65":{"line":"      this.on('finish', function() {","coverage":87},"66":{"line":"        return this.parser.end();","coverage":1},"67":{"line":"      });","coverage":""},"68":{"line":"    }","coverage":""},"69":{"line":"","coverage":""},"70":{"line":"    Decoder.prototype.start = function() {","coverage":1},"71":{"line":"      return this.parser.start();","coverage":86},"72":{"line":"    };","coverage":""},"73":{"line":"","coverage":""},"74":{"line":"    Decoder.prototype._on_error = function(er) {","coverage":1},"75":{"line":"      return this.emit('error', er);","coverage":5},"76":{"line":"    };","coverage":""},"77":{"line":"","coverage":""},"78":{"line":"    Decoder.prototype._process = function(val, tags, kind) {","coverage":1},"79":{"line":"      var er, f, key, t, _i, _ref;","coverage":224},"80":{"line":"      for (_i = tags.length - 1; _i &gt;= 0; _i += -1) {","coverage":224},"81":{"line":"        t = tags[_i];","coverage":15},"82":{"line":"        try {","coverage":15},"83":{"line":"          f = this.tags[t];","coverage":15},"84":{"line":"          if (f != null) {","coverage":15},"85":{"line":"            val = (_ref = f.call(this, val)) != null ? _ref : new Tagged(t, val);","coverage":13},"86":{"line":"          } else {","coverage":""},"87":{"line":"            val = new Tagged(t, val);","coverage":2},"88":{"line":"          }","coverage":""},"89":{"line":"        } catch (_error) {","coverage":""},"90":{"line":"          er = _error;","coverage":1},"91":{"line":"          val = new Tagged(t, val, er);","coverage":1},"92":{"line":"        }","coverage":""},"93":{"line":"      }","coverage":""},"94":{"line":"      switch (kind) {","coverage":224},"95":{"line":"        case null:","coverage":""},"96":{"line":"          return this.emit('complete', val);","coverage":82},"97":{"line":"        case 'array-first':","coverage":""},"98":{"line":"        case 'array':","coverage":""},"99":{"line":"          return this.last.push(val);","coverage":105},"100":{"line":"        case 'key-first':","coverage":""},"101":{"line":"        case 'key':","coverage":""},"102":{"line":"          return this.stack.push(val);","coverage":14},"103":{"line":"        case 'stream-first':","coverage":""},"104":{"line":"        case 'stream':","coverage":""},"105":{"line":"          return this.last.write(val);","coverage":9},"106":{"line":"        case 'value':","coverage":""},"107":{"line":"          key = this.stack.pop();","coverage":14},"108":{"line":"          return this.last[key] = val;","coverage":14},"109":{"line":"        default:","coverage":""},"110":{"line":"          return console.log('unknown', kind);","coverage":0},"111":{"line":"      }","coverage":""},"112":{"line":"    };","coverage":""},"113":{"line":"","coverage":""},"114":{"line":"    Decoder.prototype._on_value = function(val, tags, kind) {","coverage":1},"115":{"line":"      return this._process(val, tags, kind);","coverage":185},"116":{"line":"    };","coverage":""},"117":{"line":"","coverage":""},"118":{"line":"    Decoder.prototype._on_array_start = function(count, tags, kind) {","coverage":1},"119":{"line":"      if (this.last != null) {","coverage":29},"120":{"line":"        this.stack.push(this.last);","coverage":12},"121":{"line":"      }","coverage":""},"122":{"line":"      return this.last = [];","coverage":29},"123":{"line":"    };","coverage":""},"124":{"line":"","coverage":""},"125":{"line":"    Decoder.prototype._on_array_stop = function(count, tags, kind) {","coverage":1},"126":{"line":"      var val, _ref;","coverage":29},"127":{"line":"      _ref = [this.last, this.stack.pop()], val = _ref[0], this.last = _ref[1];","coverage":29},"128":{"line":"      return this._process(val, tags, kind);","coverage":29},"129":{"line":"    };","coverage":""},"130":{"line":"","coverage":""},"131":{"line":"    Decoder.prototype._on_map_start = function(count, tags, kind) {","coverage":1},"132":{"line":"      if (this.last != null) {","coverage":8},"133":{"line":"        this.stack.push(this.last);","coverage":2},"134":{"line":"      }","coverage":""},"135":{"line":"      return this.last = {};","coverage":8},"136":{"line":"    };","coverage":""},"137":{"line":"","coverage":""},"138":{"line":"    Decoder.prototype._on_map_stop = function(count, tags, kind) {","coverage":1},"139":{"line":"      var val, _ref;","coverage":7},"140":{"line":"      _ref = [this.last, this.stack.pop()], val = _ref[0], this.last = _ref[1];","coverage":7},"141":{"line":"      return this._process(val, tags, kind);","coverage":7},"142":{"line":"    };","coverage":""},"143":{"line":"","coverage":""},"144":{"line":"    Decoder.prototype._on_stream_start = function(mt, tags, kind) {","coverage":1},"145":{"line":"      if (this.last != null) {","coverage":4},"146":{"line":"        this.stack.push(this.last);","coverage":1},"147":{"line":"      }","coverage":""},"148":{"line":"      return this.last = new BufferStream;","coverage":4},"149":{"line":"    };","coverage":""},"150":{"line":"","coverage":""},"151":{"line":"    Decoder.prototype._on_stream_stop = function(count, mt, tags, kind) {","coverage":1},"152":{"line":"      var val, _ref;","coverage":3},"153":{"line":"      _ref = [this.last, this.stack.pop()], val = _ref[0], this.last = _ref[1];","coverage":3},"154":{"line":"      val = val.read();","coverage":3},"155":{"line":"      if (mt === MT.UTF8_STRING) {","coverage":3},"156":{"line":"        val = val.toString('utf8');","coverage":2},"157":{"line":"      }","coverage":""},"158":{"line":"      return this._process(val, tags, kind);","coverage":3},"159":{"line":"    };","coverage":""},"160":{"line":"","coverage":""},"161":{"line":"    Decoder.prototype._on_end = function() {","coverage":1},"162":{"line":"      return this.emit('end');","coverage":82},"163":{"line":"    };","coverage":""},"164":{"line":"","coverage":""},"165":{"line":"    Decoder.prototype._write = function(buf, offset, encoding) {","coverage":1},"166":{"line":"      return this.parser.write(buf, offset, encoding);","coverage":1},"167":{"line":"    };","coverage":""},"168":{"line":"","coverage":""},"169":{"line":"    Decoder.decode = function(buf, cb) {","coverage":1},"170":{"line":"      var actual, d;","coverage":6},"171":{"line":"      if (cb == null) {","coverage":6},"172":{"line":"        throw new Error(\"cb must be specified\");","coverage":0},"173":{"line":"      }","coverage":""},"174":{"line":"      d = new Decoder({","coverage":6},"175":{"line":"        input: buf","coverage":""},"176":{"line":"      });","coverage":""},"177":{"line":"      actual = [];","coverage":6},"178":{"line":"      d.on('complete', function(v) {","coverage":6},"179":{"line":"        return actual.push(v);","coverage":1},"180":{"line":"      });","coverage":""},"181":{"line":"      d.on('end', function() {","coverage":6},"182":{"line":"        return cb(null, actual);","coverage":1},"183":{"line":"      });","coverage":""},"184":{"line":"      d.on('error', cb);","coverage":6},"185":{"line":"      return d.start();","coverage":6},"186":{"line":"    };","coverage":""},"187":{"line":"","coverage":""},"188":{"line":"    Decoder._tag_DATE_STRING = function(val) {","coverage":1},"189":{"line":"      return new Date(val);","coverage":2},"190":{"line":"    };","coverage":""},"191":{"line":"","coverage":""},"192":{"line":"    Decoder._tag_DATE_EPOCH = function(val) {","coverage":1},"193":{"line":"      return new Date(val * 1000);","coverage":2},"194":{"line":"    };","coverage":""},"195":{"line":"","coverage":""},"196":{"line":"    Decoder._tag_POS_BIGINT = function(val) {","coverage":1},"197":{"line":"      return utils.bufferToBignumber(val);","coverage":1},"198":{"line":"    };","coverage":""},"199":{"line":"","coverage":""},"200":{"line":"    Decoder._tag_NEG_BIGINT = function(val) {","coverage":1},"201":{"line":"      return MINUS_ONE.minus(utils.bufferToBignumber(val));","coverage":1},"202":{"line":"    };","coverage":""},"203":{"line":"","coverage":""},"204":{"line":"    Decoder._tag_DECIMAL_FRAC = function(val) {","coverage":1},"205":{"line":"      var e, m;","coverage":2},"206":{"line":"      e = val[0], m = val[1];","coverage":2},"207":{"line":"      return TEN.pow(e).times(m);","coverage":2},"208":{"line":"    };","coverage":""},"209":{"line":"","coverage":""},"210":{"line":"    Decoder._tag_BIGFLOAT = function(val) {","coverage":1},"211":{"line":"      var e, m;","coverage":2},"212":{"line":"      e = val[0], m = val[1];","coverage":2},"213":{"line":"      return TWO.pow(e).times(m);","coverage":2},"214":{"line":"    };","coverage":""},"215":{"line":"","coverage":""},"216":{"line":"    Decoder._tag_URI = function(val) {","coverage":1},"217":{"line":"      return url.parse(val);","coverage":1},"218":{"line":"    };","coverage":""},"219":{"line":"","coverage":""},"220":{"line":"    Decoder._tag_REGEXP = function(val) {","coverage":1},"221":{"line":"      return new RegExp(val);","coverage":1},"222":{"line":"    };","coverage":""},"223":{"line":"","coverage":""},"224":{"line":"    return Decoder;","coverage":1},"225":{"line":"","coverage":""},"226":{"line":"  })(stream.Writable);","coverage":""},"227":{"line":"","coverage":""},"228":{"line":"  for (k in TAG) {","coverage":1},"229":{"line":"    v = TAG[k];","coverage":15},"230":{"line":"    f = Decoder[\"_tag_\" + k];","coverage":15},"231":{"line":"    if (typeof f === 'function') {","coverage":15},"232":{"line":"      DEFAULT_TAG_FUNCS[v] = f;","coverage":8},"233":{"line":"    }","coverage":""},"234":{"line":"  }","coverage":""},"235":{"line":"","coverage":""},"236":{"line":"}).call(this);","coverage":""}}},{"filename":"encoder.js","coverage":97.54901960784314,"hits":199,"misses":5,"sloc":204,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  var BufferStream, DOUBLE, Encoder, FALSE, MT, NULL, NUM_BYTES, SHIFT32, Simple, TAG, TRUE, Tagged, UNDEFINED, bignumber, constants, stream, url,","coverage":1},"4":{"line":"    __hasProp = {}.hasOwnProperty,","coverage":""},"5":{"line":"    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },","coverage":13},"6":{"line":"    __slice = [].slice;","coverage":""},"7":{"line":"","coverage":""},"8":{"line":"  stream = require('stream');","coverage":1},"9":{"line":"","coverage":""},"10":{"line":"  url = require('url');","coverage":1},"11":{"line":"","coverage":""},"12":{"line":"  bignumber = require('bignumber.js');","coverage":1},"13":{"line":"","coverage":""},"14":{"line":"  BufferStream = require('../lib/BufferStream');","coverage":1},"15":{"line":"","coverage":""},"16":{"line":"  Tagged = require('../lib/tagged');","coverage":1},"17":{"line":"","coverage":""},"18":{"line":"  Simple = require('../lib/simple');","coverage":1},"19":{"line":"","coverage":""},"20":{"line":"  constants = require('./constants');","coverage":1},"21":{"line":"","coverage":""},"22":{"line":"  MT = constants.MT;","coverage":1},"23":{"line":"","coverage":""},"24":{"line":"  NUM_BYTES = constants.NUM_BYTES;","coverage":1},"25":{"line":"","coverage":""},"26":{"line":"  TAG = constants.TAG;","coverage":1},"27":{"line":"","coverage":""},"28":{"line":"  SHIFT32 = Math.pow(2, 32);","coverage":1},"29":{"line":"","coverage":""},"30":{"line":"  DOUBLE = (MT.SIMPLE_FLOAT &lt;&lt; 5) | NUM_BYTES.EIGHT;","coverage":1},"31":{"line":"","coverage":""},"32":{"line":"  TRUE = (MT.SIMPLE_FLOAT &lt;&lt; 5) | constants.SIMPLE.TRUE;","coverage":1},"33":{"line":"","coverage":""},"34":{"line":"  FALSE = (MT.SIMPLE_FLOAT &lt;&lt; 5) | constants.SIMPLE.FALSE;","coverage":1},"35":{"line":"","coverage":""},"36":{"line":"  UNDEFINED = (MT.SIMPLE_FLOAT &lt;&lt; 5) | constants.SIMPLE.UNDEFINED;","coverage":1},"37":{"line":"","coverage":""},"38":{"line":"  NULL = (MT.SIMPLE_FLOAT &lt;&lt; 5) | constants.SIMPLE.NULL;","coverage":1},"39":{"line":"","coverage":""},"40":{"line":"  module.exports = Encoder = (function(_super) {","coverage":1},"41":{"line":"    __extends(Encoder, _super);","coverage":1},"42":{"line":"","coverage":""},"43":{"line":"    function Encoder(options) {","coverage":1},"44":{"line":"      var addTypes, i, typ, _i, _len, _ref;","coverage":81},"45":{"line":"      if (options == null) {","coverage":81},"46":{"line":"        options = {};","coverage":80},"47":{"line":"      }","coverage":""},"48":{"line":"      Encoder.__super__.constructor.call(this, options);","coverage":81},"49":{"line":"      this.bs = new BufferStream(options);","coverage":81},"50":{"line":"      this.going = false;","coverage":81},"51":{"line":"      this.sendEOF = false;","coverage":81},"52":{"line":"      this.semanticTypes = [Array, this._packArray, Date, this._packDate, Buffer, this._packBuffer, RegExp, this._packRegexp, url.Url, this._packUrl, bignumber, this._packBigNumber];","coverage":81},"53":{"line":"      addTypes = (_ref = options.genTypes) != null ? _ref : [];","coverage":81},"54":{"line":"      for (i = _i = 0, _len = addTypes.length; _i &lt; _len; i = _i += 2) {","coverage":81},"55":{"line":"        typ = addTypes[i];","coverage":1},"56":{"line":"        this.addSemanticType(typ, addTypes[i + 1]);","coverage":1},"57":{"line":"      }","coverage":""},"58":{"line":"    }","coverage":""},"59":{"line":"","coverage":""},"60":{"line":"    Encoder.prototype.addSemanticType = function(type, fun) {","coverage":1},"61":{"line":"      var i, old, typ, _i, _len, _ref, _ref1;","coverage":2},"62":{"line":"      _ref = this.semanticTypes;","coverage":2},"63":{"line":"      for (i = _i = 0, _len = _ref.length; _i &lt; _len; i = _i += 2) {","coverage":2},"64":{"line":"        typ = _ref[i];","coverage":9},"65":{"line":"        if (typ === type) {","coverage":9},"66":{"line":"          _ref1 = [this.semanticTypes[i + 1], fun], old = _ref1[0], this.semanticTypes[i + 1] = _ref1[1];","coverage":1},"67":{"line":"          return old;","coverage":1},"68":{"line":"        }","coverage":""},"69":{"line":"      }","coverage":""},"70":{"line":"      this.semanticTypes.push(type, fun);","coverage":1},"71":{"line":"      return null;","coverage":1},"72":{"line":"    };","coverage":""},"73":{"line":"","coverage":""},"74":{"line":"    Encoder.prototype._read = function(size) {","coverage":1},"75":{"line":"      var x, _results;","coverage":82},"76":{"line":"      this.going = true;","coverage":82},"77":{"line":"      _results = [];","coverage":82},"78":{"line":"      while (this.going) {","coverage":82},"79":{"line":"        x = this.bs.read();","coverage":163},"80":{"line":"        if (x.length) {","coverage":163},"81":{"line":"          _results.push(this.going = this.push(x));","coverage":81},"82":{"line":"        } else {","coverage":""},"83":{"line":"          if (this.sendEOF) {","coverage":82},"84":{"line":"            this.going = this.push(null);","coverage":80},"85":{"line":"          }","coverage":""},"86":{"line":"          break;","coverage":82},"87":{"line":"        }","coverage":""},"88":{"line":"      }","coverage":""},"89":{"line":"      return _results;","coverage":82},"90":{"line":"    };","coverage":""},"91":{"line":"","coverage":""},"92":{"line":"    Encoder.prototype._packNaN = function() {","coverage":1},"93":{"line":"      return this.bs.write('f97e00', 'hex');","coverage":1},"94":{"line":"    };","coverage":""},"95":{"line":"","coverage":""},"96":{"line":"    Encoder.prototype._packInfinity = function(obj) {","coverage":1},"97":{"line":"      var half;","coverage":2},"98":{"line":"      half = obj &lt; 0 ? 'f9fc00' : 'f97c00';","coverage":2},"99":{"line":"      return this.bs.write(half, 'hex');","coverage":2},"100":{"line":"    };","coverage":""},"101":{"line":"","coverage":""},"102":{"line":"    Encoder.prototype._packFloat = function(obj) {","coverage":1},"103":{"line":"      this.bs.writeUInt8(DOUBLE);","coverage":8},"104":{"line":"      return this.bs.writeDoubleBE(obj);","coverage":8},"105":{"line":"    };","coverage":""},"106":{"line":"","coverage":""},"107":{"line":"    Encoder.prototype._packInt = function(obj, mt) {","coverage":1},"108":{"line":"      mt = mt &lt;&lt; 5;","coverage":191},"109":{"line":"      switch (false) {","coverage":191},"110":{"line":"        case !(obj &lt; 24):","coverage":""},"111":{"line":"          return this.bs.writeUInt8(mt | obj);","coverage":158},"112":{"line":"        case !(obj &lt;= 0xff):","coverage":""},"113":{"line":"          this.bs.writeUInt8(mt | NUM_BYTES.ONE);","coverage":16},"114":{"line":"          return this.bs.writeUInt8(obj);","coverage":16},"115":{"line":"        case !(obj &lt;= 0xffff):","coverage":""},"116":{"line":"          this.bs.writeUInt8(mt | NUM_BYTES.TWO);","coverage":6},"117":{"line":"          return this.bs.writeUInt16BE(obj);","coverage":6},"118":{"line":"        case !(obj &lt;= 0xffffffff):","coverage":""},"119":{"line":"          this.bs.writeUInt8(mt | NUM_BYTES.FOUR);","coverage":5},"120":{"line":"          return this.bs.writeUInt32BE(obj);","coverage":5},"121":{"line":"        case !(obj &lt; 0x20000000000000):","coverage":""},"122":{"line":"          this.bs.writeUInt8(mt | NUM_BYTES.EIGHT);","coverage":3},"123":{"line":"          this.bs.writeUInt32BE(Math.floor(obj / SHIFT32));","coverage":3},"124":{"line":"          return this.bs.writeUInt32BE(obj % SHIFT32);","coverage":3},"125":{"line":"        default:","coverage":""},"126":{"line":"          return this._packFloat(obj);","coverage":3},"127":{"line":"      }","coverage":""},"128":{"line":"    };","coverage":""},"129":{"line":"","coverage":""},"130":{"line":"    Encoder.prototype._packNumber = function(obj) {","coverage":1},"131":{"line":"      switch (false) {","coverage":106},"132":{"line":"        case !isNaN(obj):","coverage":""},"133":{"line":"          return this._packNaN(obj);","coverage":1},"134":{"line":"        case !!isFinite(obj):","coverage":""},"135":{"line":"          return this._packInfinity(obj);","coverage":2},"136":{"line":"        case Math.round(obj) !== obj:","coverage":""},"137":{"line":"          if (obj &lt; 0) {","coverage":98},"138":{"line":"            return this._packInt(-obj - 1, MT.NEG_INT);","coverage":5},"139":{"line":"          } else {","coverage":""},"140":{"line":"            return this._packInt(obj, MT.POS_INT);","coverage":93},"141":{"line":"          }","coverage":""},"142":{"line":"          break;","coverage":0},"143":{"line":"        default:","coverage":""},"144":{"line":"          return this._packFloat(obj);","coverage":5},"145":{"line":"      }","coverage":""},"146":{"line":"    };","coverage":""},"147":{"line":"","coverage":""},"148":{"line":"    Encoder.prototype._packString = function(obj) {","coverage":1},"149":{"line":"      var len;","coverage":38},"150":{"line":"      len = Buffer.byteLength(obj, 'utf8');","coverage":38},"151":{"line":"      this._packInt(len, MT.UTF8_STRING);","coverage":38},"152":{"line":"      return this.bs.writeString(obj, len, 'utf8');","coverage":38},"153":{"line":"    };","coverage":""},"154":{"line":"","coverage":""},"155":{"line":"    Encoder.prototype._packBoolean = function(obj) {","coverage":1},"156":{"line":"      return this.bs.writeUInt8(obj ? TRUE : FALSE);","coverage":2},"157":{"line":"    };","coverage":""},"158":{"line":"","coverage":""},"159":{"line":"    Encoder.prototype._packUndefined = function(obj) {","coverage":1},"160":{"line":"      return this.bs.writeUInt8(UNDEFINED);","coverage":1},"161":{"line":"    };","coverage":""},"162":{"line":"","coverage":""},"163":{"line":"    Encoder.prototype._packArray = function(gen, obj) {","coverage":1},"164":{"line":"      var len, x, _i, _len, _results;","coverage":15},"165":{"line":"      len = obj.length;","coverage":15},"166":{"line":"      this._packInt(len, MT.ARRAY);","coverage":15},"167":{"line":"      _results = [];","coverage":15},"168":{"line":"      for (_i = 0, _len = obj.length; _i &lt; _len; _i++) {","coverage":15},"169":{"line":"        x = obj[_i];","coverage":75},"170":{"line":"        _results.push(this._pack(x));","coverage":75},"171":{"line":"      }","coverage":""},"172":{"line":"      return _results;","coverage":15},"173":{"line":"    };","coverage":""},"174":{"line":"","coverage":""},"175":{"line":"    Encoder.prototype._packTag = function(tag) {","coverage":1},"176":{"line":"      return this._packInt(tag, MT.TAG);","coverage":14},"177":{"line":"    };","coverage":""},"178":{"line":"","coverage":""},"179":{"line":"    Encoder.prototype._packDate = function(gen, obj) {","coverage":1},"180":{"line":"      this._packTag(TAG.DATE_EPOCH);","coverage":2},"181":{"line":"      return this._pack(obj / 1000);","coverage":2},"182":{"line":"    };","coverage":""},"183":{"line":"","coverage":""},"184":{"line":"    Encoder.prototype._packBuffer = function(gen, obj) {","coverage":1},"185":{"line":"      this._packInt(obj.length, MT.BYTE_STRING);","coverage":10},"186":{"line":"      return this.bs.append(obj);","coverage":10},"187":{"line":"    };","coverage":""},"188":{"line":"","coverage":""},"189":{"line":"    Encoder.prototype._packRegexp = function(gen, obj) {","coverage":1},"190":{"line":"      this._packTag(TAG.REGEXP);","coverage":1},"191":{"line":"      return this._pack(obj.source);","coverage":1},"192":{"line":"    };","coverage":""},"193":{"line":"","coverage":""},"194":{"line":"    Encoder.prototype._packUrl = function(gen, obj) {","coverage":1},"195":{"line":"      this._packTag(TAG.URI);","coverage":1},"196":{"line":"      return this._pack(obj.format());","coverage":1},"197":{"line":"    };","coverage":""},"198":{"line":"","coverage":""},"199":{"line":"    Encoder.prototype._packBigint = function(obj) {","coverage":1},"200":{"line":"      var buf, str, tag;","coverage":5},"201":{"line":"      if (obj.isNegative()) {","coverage":5},"202":{"line":"        obj = obj.negated().minus(1);","coverage":1},"203":{"line":"        tag = TAG.NEG_BIGINT;","coverage":1},"204":{"line":"      } else {","coverage":""},"205":{"line":"        tag = TAG.POS_BIGINT;","coverage":4},"206":{"line":"      }","coverage":""},"207":{"line":"      str = obj.toString(16);","coverage":5},"208":{"line":"      if (str.length % 2) {","coverage":5},"209":{"line":"        str = '0' + str;","coverage":4},"210":{"line":"      }","coverage":""},"211":{"line":"      buf = new Buffer(str, 'hex');","coverage":5},"212":{"line":"      this._packTag(tag);","coverage":5},"213":{"line":"      return this._packBuffer(this, buf, this.bs);","coverage":5},"214":{"line":"    };","coverage":""},"215":{"line":"","coverage":""},"216":{"line":"    Encoder.prototype._packBigNumber = function(gen, obj) {","coverage":1},"217":{"line":"      var slide;","coverage":5},"218":{"line":"      if (obj.isNaN()) {","coverage":5},"219":{"line":"        return this._packNaN();","coverage":0},"220":{"line":"      }","coverage":""},"221":{"line":"      if (!obj.isFinite()) {","coverage":5},"222":{"line":"        return this._packInfinity(obj.isNegative() ? -Infinity : Infinity);","coverage":0},"223":{"line":"      }","coverage":""},"224":{"line":"      if (obj.c.length &lt; (obj.e + 2)) {","coverage":5},"225":{"line":"        return this._packBigint(obj);","coverage":3},"226":{"line":"      }","coverage":""},"227":{"line":"      this._packTag(TAG.DECIMAL_FRAC);","coverage":2},"228":{"line":"      this._packInt(2, MT.ARRAY);","coverage":2},"229":{"line":"      slide = new bignumber(obj);","coverage":2},"230":{"line":"      this._packInt(slide.e, MT.POS_INT);","coverage":2},"231":{"line":"      slide.e = slide.c.length - 1;","coverage":2},"232":{"line":"      return this._packBigint(slide);","coverage":2},"233":{"line":"    };","coverage":""},"234":{"line":"","coverage":""},"235":{"line":"    Encoder.prototype._packObject = function(obj) {","coverage":1},"236":{"line":"      var f, i, k, keys, len, typ, _i, _j, _len, _len1, _ref, _results;","coverage":46},"237":{"line":"      if (!obj) {","coverage":46},"238":{"line":"        return this.bs.writeUInt8(NULL);","coverage":1},"239":{"line":"      }","coverage":""},"240":{"line":"      _ref = this.semanticTypes;","coverage":45},"241":{"line":"      for (i = _i = 0, _len = _ref.length; _i &lt; _len; i = _i += 2) {","coverage":45},"242":{"line":"        typ = _ref[i];","coverage":167},"243":{"line":"        if (obj instanceof typ) {","coverage":167},"244":{"line":"          return this.semanticTypes[i + 1].call(this, this, obj);","coverage":31},"245":{"line":"        }","coverage":""},"246":{"line":"      }","coverage":""},"247":{"line":"      f = obj.encodeCBOR;","coverage":14},"248":{"line":"      if (typeof f === 'function') {","coverage":14},"249":{"line":"        return f.call(obj, this);","coverage":6},"250":{"line":"      }","coverage":""},"251":{"line":"      keys = Object.keys(obj);","coverage":8},"252":{"line":"      len = keys.length;","coverage":8},"253":{"line":"      this._packInt(len, MT.MAP);","coverage":8},"254":{"line":"      _results = [];","coverage":8},"255":{"line":"      for (_j = 0, _len1 = keys.length; _j &lt; _len1; _j++) {","coverage":8},"256":{"line":"        k = keys[_j];","coverage":14},"257":{"line":"        this._pack(k);","coverage":14},"258":{"line":"        _results.push(this._pack(obj[k]));","coverage":14},"259":{"line":"      }","coverage":""},"260":{"line":"      return _results;","coverage":8},"261":{"line":"    };","coverage":""},"262":{"line":"","coverage":""},"263":{"line":"    Encoder.prototype._pack = function(obj) {","coverage":1},"264":{"line":"      switch (typeof obj) {","coverage":193},"265":{"line":"        case 'number':","coverage":""},"266":{"line":"          return this._packNumber(obj);","coverage":106},"267":{"line":"        case 'string':","coverage":""},"268":{"line":"          return this._packString(obj);","coverage":38},"269":{"line":"        case 'boolean':","coverage":""},"270":{"line":"          return this._packBoolean(obj);","coverage":2},"271":{"line":"        case 'undefined':","coverage":""},"272":{"line":"          return this._packUndefined(obj);","coverage":1},"273":{"line":"        case 'object':","coverage":""},"274":{"line":"          return this._packObject(obj);","coverage":46},"275":{"line":"        default:","coverage":""},"276":{"line":"          throw new Error('Unknown type: ' + typeof obj);","coverage":0},"277":{"line":"      }","coverage":""},"278":{"line":"    };","coverage":""},"279":{"line":"","coverage":""},"280":{"line":"    Encoder.prototype.write = function() {","coverage":1},"281":{"line":"      var o, objs, x, _i, _len, _results;","coverage":83},"282":{"line":"      objs = 1 &lt;= arguments.length ? __slice.call(arguments, 0) : [];","coverage":83},"283":{"line":"      _results = [];","coverage":83},"284":{"line":"      for (_i = 0, _len = objs.length; _i &lt; _len; _i++) {","coverage":83},"285":{"line":"        o = objs[_i];","coverage":83},"286":{"line":"        this._pack(o);","coverage":83},"287":{"line":"        if (this.going) {","coverage":83},"288":{"line":"          x = this.bs.read();","coverage":2},"289":{"line":"          if (x.length) {","coverage":2},"290":{"line":"            _results.push(this.going = this.push(x));","coverage":1},"291":{"line":"          } else {","coverage":""},"292":{"line":"            _results.push(void 0);","coverage":1},"293":{"line":"          }","coverage":""},"294":{"line":"        } else {","coverage":""},"295":{"line":"          _results.push(void 0);","coverage":81},"296":{"line":"        }","coverage":""},"297":{"line":"      }","coverage":""},"298":{"line":"      return _results;","coverage":83},"299":{"line":"    };","coverage":""},"300":{"line":"","coverage":""},"301":{"line":"    Encoder.prototype.end = function() {","coverage":1},"302":{"line":"      var objs;","coverage":80},"303":{"line":"      objs = 1 &lt;= arguments.length ? __slice.call(arguments, 0) : [];","coverage":80},"304":{"line":"      if (objs.length) {","coverage":80},"305":{"line":"        this.write.apply(this, objs);","coverage":80},"306":{"line":"      }","coverage":""},"307":{"line":"      if (this.going) {","coverage":80},"308":{"line":"        return this.going = this.push(null);","coverage":0},"309":{"line":"      } else {","coverage":""},"310":{"line":"        return this.sendEOF = true;","coverage":80},"311":{"line":"      }","coverage":""},"312":{"line":"    };","coverage":""},"313":{"line":"","coverage":""},"314":{"line":"    Encoder.encode = function() {","coverage":1},"315":{"line":"      var g, objs;","coverage":80},"316":{"line":"      objs = 1 &lt;= arguments.length ? __slice.call(arguments, 0) : [];","coverage":80},"317":{"line":"      g = new Encoder;","coverage":80},"318":{"line":"      g.end.apply(g, objs);","coverage":80},"319":{"line":"      return g.read();","coverage":80},"320":{"line":"    };","coverage":""},"321":{"line":"","coverage":""},"322":{"line":"    return Encoder;","coverage":1},"323":{"line":"","coverage":""},"324":{"line":"  })(stream.Readable);","coverage":""},"325":{"line":"","coverage":""},"326":{"line":"}).call(this);","coverage":""}}},{"filename":"simple.js","coverage":100,"hits":18,"misses":0,"sloc":18,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  var Simple, constants;","coverage":1},"4":{"line":"","coverage":""},"5":{"line":"  constants = require('./constants');","coverage":1},"6":{"line":"","coverage":""},"7":{"line":"  Simple = (function() {","coverage":1},"8":{"line":"    function Simple(value) {","coverage":1},"9":{"line":"      this.value = value;","coverage":12},"10":{"line":"      if (typeof this.value !== 'number') {","coverage":12},"11":{"line":"        throw new Error(\"Invalid Simple type: \" + (typeof this.value));","coverage":1},"12":{"line":"      }","coverage":""},"13":{"line":"      if (!(((0 &lt;= value &amp;&amp; value &lt; 256)) &amp;&amp; ((this.value | 0) === this.value))) {","coverage":11},"14":{"line":"        throw new Error(\"value must be a small positive integer: \" + this.value);","coverage":3},"15":{"line":"      }","coverage":""},"16":{"line":"    }","coverage":""},"17":{"line":"","coverage":""},"18":{"line":"    Simple.prototype.toString = function() {","coverage":1},"19":{"line":"      return \"simple(\" + this.value + \")\";","coverage":3},"20":{"line":"    };","coverage":""},"21":{"line":"","coverage":""},"22":{"line":"    Simple.prototype.encodeCBOR = function(gen) {","coverage":1},"23":{"line":"      return gen._packInt(this.value, constants.MT.SIMPLE_FLOAT);","coverage":4},"24":{"line":"    };","coverage":""},"25":{"line":"","coverage":""},"26":{"line":"    Simple.isSimple = function(obj) {","coverage":1},"27":{"line":"      return obj instanceof Simple;","coverage":2},"28":{"line":"    };","coverage":""},"29":{"line":"","coverage":""},"30":{"line":"    return Simple;","coverage":1},"31":{"line":"","coverage":""},"32":{"line":"  })();","coverage":""},"33":{"line":"","coverage":""},"34":{"line":"  module.exports = Simple;","coverage":1},"35":{"line":"","coverage":""},"36":{"line":"}).call(this);","coverage":""}}},{"filename":"tagged.js","coverage":100,"hits":17,"misses":0,"sloc":17,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  var Tagged;","coverage":1},"4":{"line":"","coverage":""},"5":{"line":"  module.exports = Tagged = (function() {","coverage":1},"6":{"line":"    function Tagged(tag, value, err) {","coverage":1},"7":{"line":"      this.tag = tag;","coverage":7},"8":{"line":"      this.value = value;","coverage":7},"9":{"line":"      this.err = err;","coverage":7},"10":{"line":"      if (typeof this.tag !== 'number') {","coverage":7},"11":{"line":"        throw new Error(\"Invalid tag type (\" + (typeof this.tag) + \")\");","coverage":1},"12":{"line":"      }","coverage":""},"13":{"line":"      if ((this.tag &lt; 0) || ((this.tag | 0) !== this.tag)) {","coverage":6},"14":{"line":"        throw new Error(\"Tag must be a positive integer: \" + this.tag);","coverage":2},"15":{"line":"      }","coverage":""},"16":{"line":"    }","coverage":""},"17":{"line":"","coverage":""},"18":{"line":"    Tagged.prototype.toString = function() {","coverage":1},"19":{"line":"      return \"\" + this.tag + \"(\" + (JSON.stringify(this.value)) + \")\";","coverage":2},"20":{"line":"    };","coverage":""},"21":{"line":"","coverage":""},"22":{"line":"    Tagged.prototype.encodeCBOR = function(gen) {","coverage":1},"23":{"line":"      gen._packTag(this.tag);","coverage":1},"24":{"line":"      return gen._pack(this.value);","coverage":1},"25":{"line":"    };","coverage":""},"26":{"line":"","coverage":""},"27":{"line":"    return Tagged;","coverage":1},"28":{"line":"","coverage":""},"29":{"line":"  })();","coverage":""},"30":{"line":"","coverage":""},"31":{"line":"}).call(this);","coverage":""}}},{"filename":"utils.js","coverage":100,"hits":63,"misses":0,"sloc":63,"source":{"1":{"line":"// Generated by CoffeeScript 1.7.1","coverage":""},"2":{"line":"(function() {","coverage":1},"3":{"line":"  var SHIFT32, bignumber, parseHalf,","coverage":1},"4":{"line":"    __slice = [].slice;","coverage":""},"5":{"line":"","coverage":""},"6":{"line":"  bignumber = require('bignumber.js');","coverage":1},"7":{"line":"","coverage":""},"8":{"line":"  SHIFT32 = Math.pow(2, 32);","coverage":1},"9":{"line":"","coverage":""},"10":{"line":"  exports.parseInt = function(ai, buf) {","coverage":1},"11":{"line":"    var f, g;","coverage":6},"12":{"line":"    switch (ai) {","coverage":6},"13":{"line":"      case 24:","coverage":""},"14":{"line":"        return buf.readUInt8(0, true);","coverage":1},"15":{"line":"      case 25:","coverage":""},"16":{"line":"        return buf.readUInt16BE(0, true);","coverage":1},"17":{"line":"      case 26:","coverage":""},"18":{"line":"        return buf.readUInt32BE(0, true);","coverage":1},"19":{"line":"      case 27:","coverage":""},"20":{"line":"        f = buf.readUInt32BE(0);","coverage":2},"21":{"line":"        g = buf.readUInt32BE(4);","coverage":1},"22":{"line":"        return (f * SHIFT32) + g;","coverage":1},"23":{"line":"      default:","coverage":""},"24":{"line":"        throw new Error(\"Invalid additional info for int: \" + ai);","coverage":1},"25":{"line":"    }","coverage":""},"26":{"line":"  };","coverage":""},"27":{"line":"","coverage":""},"28":{"line":"  exports.parseHalf = parseHalf = function(buf) {","coverage":1},"29":{"line":"    var exp, mant, sign;","coverage":9},"30":{"line":"    sign = buf[0] &amp; 0x80 ? -1 : 1;","coverage":9},"31":{"line":"    exp = (buf[0] &amp; 0x7C) &gt;&gt; 2;","coverage":9},"32":{"line":"    mant = ((buf[0] &amp; 0x03) &lt;&lt; 8) | buf[1];","coverage":9},"33":{"line":"    if (!exp) {","coverage":9},"34":{"line":"      return sign * 5.9604644775390625e-8 * mant;","coverage":3},"35":{"line":"    } else if (exp === 0x1f) {","coverage":6},"36":{"line":"      return sign * (mant ? NaN : Infinity);","coverage":2},"37":{"line":"    } else {","coverage":""},"38":{"line":"      return sign * Math.pow(2, exp - 25) * (1024 + mant);","coverage":4},"39":{"line":"    }","coverage":""},"40":{"line":"  };","coverage":""},"41":{"line":"","coverage":""},"42":{"line":"  exports.parseFloat = function(ai, buf) {","coverage":1},"43":{"line":"    switch (ai) {","coverage":5},"44":{"line":"      case 25:","coverage":""},"45":{"line":"        return parseHalf(buf);","coverage":1},"46":{"line":"      case 26:","coverage":""},"47":{"line":"        return buf.readFloatBE(0, true);","coverage":1},"48":{"line":"      case 27:","coverage":""},"49":{"line":"        return buf.readDoubleBE(0, true);","coverage":1},"50":{"line":"      default:","coverage":""},"51":{"line":"        throw new Error(\"Invalid additional info for float: \" + ai);","coverage":2},"52":{"line":"    }","coverage":""},"53":{"line":"  };","coverage":""},"54":{"line":"","coverage":""},"55":{"line":"  exports.hex = function(s) {","coverage":1},"56":{"line":"    return new Buffer(s.replace(/^0x/, ''), 'hex');","coverage":92},"57":{"line":"  };","coverage":""},"58":{"line":"","coverage":""},"59":{"line":"  exports.bin = function(s) {","coverage":1},"60":{"line":"    var chunks, end, start;","coverage":14},"61":{"line":"    s = s.replace(/\\s/g, '');","coverage":14},"62":{"line":"    start = 0;","coverage":14},"63":{"line":"    end = s.length % 8 || 8;","coverage":14},"64":{"line":"    chunks = [];","coverage":14},"65":{"line":"    while (end &lt;= s.length) {","coverage":14},"66":{"line":"      chunks.push(parseInt(s.slice(start, end), 2));","coverage":34},"67":{"line":"      start = end;","coverage":34},"68":{"line":"      end += 8;","coverage":34},"69":{"line":"    }","coverage":""},"70":{"line":"    return new Buffer(chunks);","coverage":14},"71":{"line":"  };","coverage":""},"72":{"line":"","coverage":""},"73":{"line":"  exports.extend = function() {","coverage":1},"74":{"line":"    var a, adds, k, old, v, _i, _len;","coverage":5},"75":{"line":"    old = arguments[0], adds = 2 &lt;= arguments.length ? __slice.call(arguments, 1) : [];","coverage":5},"76":{"line":"    if (old == null) {","coverage":5},"77":{"line":"      old = {};","coverage":1},"78":{"line":"    }","coverage":""},"79":{"line":"    for (_i = 0, _len = adds.length; _i &lt; _len; _i++) {","coverage":5},"80":{"line":"      a = adds[_i];","coverage":5},"81":{"line":"      for (k in a) {","coverage":5},"82":{"line":"        v = a[k];","coverage":5},"83":{"line":"        old[k] = v;","coverage":5},"84":{"line":"      }","coverage":""},"85":{"line":"    }","coverage":""},"86":{"line":"    return old;","coverage":5},"87":{"line":"  };","coverage":""},"88":{"line":"","coverage":""},"89":{"line":"  exports.arrayEqual = function(a, b) {","coverage":1},"90":{"line":"    if ((a == null) &amp;&amp; (b == null)) {","coverage":6},"91":{"line":"      return true;","coverage":1},"92":{"line":"    }","coverage":""},"93":{"line":"    if ((a == null) || (b == null)) {","coverage":5},"94":{"line":"      return false;","coverage":1},"95":{"line":"    }","coverage":""},"96":{"line":"    return (a.length === b.length) &amp;&amp; a.every(function(elem, i) {","coverage":4},"97":{"line":"      return elem === b[i];","coverage":6},"98":{"line":"    });","coverage":""},"99":{"line":"  };","coverage":""},"100":{"line":"","coverage":""},"101":{"line":"  exports.bufferToBignumber = function(buf) {","coverage":1},"102":{"line":"    return new bignumber(buf.toString('hex'), 16);","coverage":1},"103":{"line":"  };","coverage":""},"104":{"line":"","coverage":""},"105":{"line":"}).call(this);","coverage":""}}}],"hits":1090,"misses":40,"sloc":1130,"instrumentation":"node-jscoverage","coverage":96.46017699115043}